<h2 id="local-ui-requireui"><code>local ui = require'ui'</code></h2>
<p>Extensible UI toolkit written in Lua with widgets, layouts, styles and animations.</p>
<p>Uses <a href="/nw">nw</a> for creating and using native windows, providing a bitmap surface to draw on, and for mouse and keyboard input. Uses <a href="/terra.layer">terra.layer</a> for layouting, drawing and hit-testing, which in turn uses <a href="/cairo">cairo</a> for path filling, stroking, clipping, masking and blending, <a href="/terra.tr">terra.tr</a> for text shaping, rendering, editing and hit-testing, and <a href="/boxblur">boxblur</a> for shadows.</p>
<h2 id="status">Status</h2>
<p><warn>In active development.</warn></p>
<p>Still has a few good months of development ahead. You can track the progress in the <a href="https://trello.com/b/xde8hdAZ/luapower">luapower trello board</a>. Once the API and codebase stabilizes, further progress will be tracked via github issues. Also see <a href="/ui0">ui0</a> for a working prototype in pure Lua.</p>
<h2 id="highlights">Highlights</h2>
<ul>
<li>editable grid that can scroll millions of rows at 60 fps.</li>
<li>tab list with animated, moveable, draggable, dockable tabs.</li>
<li>extensible rich text editor with BiDi support.</li>
<li>consistent Unicode text rendering and editing on all platforms.</li>
<li>customization with cascading styles, inheritance and composition.</li>
<li>declarative transition animations.</li>
<li>flexbox and css-grid-like layouts.</li>
</ul>
<h2 id="before-using">Before using</h2>
<p>You need to get some fonts in order to see text on screen. Refer to <a href="#font-management">Font management</a> below for that.</p>
<p>Besides the many hard dependencies this library has, there are also a few runtime dependencies that are only loaded if/when certain features are used:</p>
<ul>
<li><a href="/libjpeg">libjpeg</a>, if jpeg images are used.</li>
<li><a href="/gfonts">gfonts</a>, if google fonts are used.</li>
</ul>
<h2 id="example">Example</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">local</span> ui <span class="op">=</span> <span class="fu">require</span><span class="st">&#39;ui&#39;</span></span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">local</span> win <span class="op">=</span> ui<span class="op">:</span>window<span class="op">{</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>   cw <span class="op">=</span> <span class="dv">500</span><span class="op">,</span> ch <span class="op">=</span> <span class="dv">300</span><span class="op">,</span>   <span class="co">--client area size</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>   title <span class="op">=</span> <span class="st">&#39;UI Demo&#39;</span><span class="op">,</span>    <span class="co">--titlebar text</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>   autoquit <span class="op">=</span> <span class="kw">true</span><span class="op">,</span>      <span class="co">--quit the app on close</span></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="op">}</span></span>
<span id="cb1-8"><a href="#cb1-8"></a></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="kw">local</span> btn1 <span class="op">=</span> ui<span class="op">:</span>button<span class="op">{</span></span>
<span id="cb1-10"><a href="#cb1-10"></a>   parent <span class="op">=</span> win<span class="op">,</span>         <span class="co">--top-level widget</span></span>
<span id="cb1-11"><a href="#cb1-11"></a>   x <span class="op">=</span> <span class="dv">100</span><span class="op">,</span> y <span class="op">=</span> <span class="dv">100</span><span class="op">,</span>     <span class="co">--manually positioned by default</span></span>
<span id="cb1-12"><a href="#cb1-12"></a>   text <span class="op">=</span> <span class="st">&#39;Close&#39;</span><span class="op">,</span>       <span class="co">--sized to fit the text by default</span></span>
<span id="cb1-13"><a href="#cb1-13"></a>   cancel <span class="op">=</span> <span class="kw">true</span><span class="op">,</span>        <span class="co">--close the window on Esc</span></span>
<span id="cb1-14"><a href="#cb1-14"></a>   tags <span class="op">=</span> <span class="st">&#39;blue&#39;</span><span class="op">,</span>        <span class="co">--add a tag for styling</span></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="op">}</span></span>
<span id="cb1-16"><a href="#cb1-16"></a></span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="co">--style blue buttons for when mouse is over and no buttons are pressed.</span></span>
<span id="cb1-18"><a href="#cb1-18"></a>ui<span class="op">:</span>style<span class="op">(</span><span class="st">&#39;button blue :hot !:active&#39;</span><span class="op">,</span> <span class="op">{</span></span>
<span id="cb1-19"><a href="#cb1-19"></a>   background_color <span class="op">=</span> <span class="st">&#39;#66f&#39;</span><span class="op">,</span> <span class="co">--make the background blue</span></span>
<span id="cb1-20"><a href="#cb1-20"></a><span class="op">})</span></span>
<span id="cb1-21"><a href="#cb1-21"></a></span>
<span id="cb1-22"><a href="#cb1-22"></a><span class="kw">function</span> btn1<span class="op">:</span>pressed<span class="op">()</span> <span class="co">--handle button presses</span></span>
<span id="cb1-23"><a href="#cb1-23"></a>   <span class="fu">print</span><span class="st">&#39;Button pressed!&#39;</span></span>
<span id="cb1-24"><a href="#cb1-24"></a><span class="cf">end</span></span>
<span id="cb1-25"><a href="#cb1-25"></a></span>
<span id="cb1-26"><a href="#cb1-26"></a>win<span class="op">:</span>on<span class="op">(</span><span class="st">&#39;closed&#39;</span><span class="op">,</span> <span class="kw">function</span><span class="op">(</span>self<span class="op">)</span> <span class="co">--another way to set up an event handler</span></span>
<span id="cb1-27"><a href="#cb1-27"></a>   <span class="fu">print</span><span class="st">&#39;Bye!&#39;</span></span>
<span id="cb1-28"><a href="#cb1-28"></a><span class="cf">end</span><span class="op">)</span></span>
<span id="cb1-29"><a href="#cb1-29"></a></span>
<span id="cb1-30"><a href="#cb1-30"></a>ui<span class="op">:</span>run<span class="op">()</span></span></code></pre></div>
<h2 id="class-hierarchy">Class hierarchy</h2>
<ul>
<li><a href="/oo"><code>oo.Object</code></a> - <a href="/oo">oo</a>’s base class
<ul>
<li><code>ui.object</code> - ui’s base class. includes the <a href="/events">events</a> mixin.
<ul>
<li><a href="/ui"><code>ui</code></a> - this module, also serving as the app singleton</li>
<li><a href="#selectors"><code>ui.selector</code></a> - element selector</li>
<li><code>ui.element_list</code> - list of elements</li>
<li><a href="#stylesheets"><code>ui.stylesheet</code></a> - stylesheet</li>
<li><a href="#transition-animations"><code>ui.transition</code></a> - attribute transition</li>
<li><a href="#elements"><code>ui.element</code></a> - object with styles and transitions
<ul>
<li><a href="#windows"><code>ui.window</code></a> - top-level window: a thin layer over <a href="/nw">nw</a>’s windows
<ul>
<li><a href="#pop-up-windows"><code>ui.popup</code></a> - frameless pop-up window</li>
</ul></li>
<li><a href="#layers"><code>ui.layer</code></a> - the basic UI building block
<ul>
<li><a href="#the-top-layer"><code>ui.window_view</code></a> - a window’s top layer</li>
<li><a href="#buttons"><code>ui.button</code></a> - button</li>
<li><a href="#menus"><code>ui.menu</code></a> - menu</li>
<li><a href="#editboxes"><code>ui.editbox</code></a> - editbox</li>
<li><a href="#drop-downs"><code>ui.dropdown</code></a> - drop-down menu</li>
<li><a href="#sliders"><code>ui.slider</code></a> - slider
<ul>
<li><a href="#toggle-buttons"><code>ui.toggle</code></a> - toggle button</li>
</ul></li>
<li><a href="#checkboxes"><code>ui.checkbox</code></a> - checkbox
<ul>
<li><a href="#radio-buttons"><code>ui.radiobutton</code></a> - radio button</li>
</ul></li>
<li><a href="#choice-buttons"><code>ui.choicebutton</code></a> - choice button</li>
<li><a href="#color-pickers"><code>ui.colorpicker</code></a> - color picker</li>
<li><a href="#calendars"><code>ui.calendar</code></a> - calendar</li>
<li><a href="#progress-bars"><code>ui.progressbar</code></a> - progress bar</li>
<li><a href="#editable-grids"><code>ui.grid</code></a> - editable grid</li>
<li><a href="#scroll-bars"><code>ui.scrollbar</code></a> - scrollbar</li>
<li><a href="#scroll-boxes"><code>ui.scrollbox</code></a> - scrollbox</li>
<li><a href="#tab-lists"><code>ui.tablist</code></a> - tab list</li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
<h2 id="the-ui-modulesingleton">The ui module/singleton</h2>
<p>The ui singleton allows for creating OS windows, quitting the app, creating timers, using the clipboard, adding fonts, etc.</p>
<h3 id="forwarded-properties-methods-and-events">Forwarded properties, methods and events</h3>
<p>The ui singleton is mostly a thin facade over <a href="/nw">nw</a>’s app singleton. Those <code>ui</code> features which map directly to nw app features are listed below but are not documented here again.</p>
<table>
<colgroup>
<col style="width: 49%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>native properties</strong></td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>autoquit, maxfps, app_active,</code> <code>app_visible, caret_blink_time,</code> <code>displays, main_display,</code> <code>active_display, app_id</code></td>
<td>these map directly to <a href="/nw">nw</a> app features except they are exposed as properties instead of methods like in <a href="/nw">nw</a>.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>native methods</strong></td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>run, poll, stop, quit, runevery,</code> <code>runafter, sleep, activate_app,</code> <code>hide_app, unhide_app, key,</code> <code>getclipboard, setclipboard,</code> <code>opendialog, savedialog,</code> <code>app_already_running,</code> <code>wakeup_other_app_instances,</code> <code>check_single_app_instance</code></td>
<td>these map directly to <a href="/nw">nw</a> app methods.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>native events</strong></td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>quitting, activated, deactivated,</code> <code>wakeup, hidden, unhidden,</code> <code>displays_changed</code></td>
<td>these map directly to <a href="/nw">nw</a> app events.</td>
</tr>
</tbody>
</table>
<h3 id="font-management">Font management</h3>
<p>Fonts must be registered before they can be used (fonts can be loaded from files or from memory buffers). A few default fonts are registered automatically to make the default styles work.</p>
<h4 id="default-fonts">Default fonts</h4>
<p>Default fonts are in packages <a href="/fonts-open-sans">fonts-open-sans</a> and <a href="/fonts-ionicons">fonts-ionicons</a>. If you are on multigit, you can get them with:</p>
<pre><code>$ mgit clone fonts-open-sans fonts-ionicons</code></pre>
<p>If you have them somewhere else, set <code>ui.default_fonts_path</code> after loading <a href="/ui">ui</a>. Or set <code>ui.use_default_fonts</code> to <code>false</code> if you don’t want default fonts at all.</p>
<h4 id="custom-fonts">Custom fonts</h4>
<p>Custom fonts can be added with:</p>
<ul>
<li><code>ui:add_font_file(...)</code>, which calls <code>tr:add_font_file(...)</code>, or</li>
<li><code>ui:add_mem_font(...)</code>, which calls <code>tr:add_mem_font(...)</code>.</li>
</ul>
<p>See <a href="/font_db">font_db</a> for details on those methods. To change the default font used for text by all the layers and widgets, set <code>ui.layer.font</code> before creating any layers or widgets, or add a style on the <code>layer</code> tag with that.</p>
<h4 id="fonts-from-google-fonts">Fonts from google fonts</h4>
<p>Fonts from the google fonts repository can be used directly by name without the need to register them. To enable this, clone the google fonts repository with:</p>
<pre><code>$ git clone https://github.com/google/fonts media/fonts/gfonts</code></pre>
<p>and set <code>ui.use_google_fonts = true</code> before using <a href="/ui">ui</a>. Set <code>ui.google_fonts_path</code> too if you cloned the repo somewhere else. You also need the <a href="/gfonts">gfonts</a> module:</p>
<pre><code>$ mgit clone gfonts</code></pre>
<h2 id="elements">Elements</h2>
<p>Elements are objects with styling and transitions and a standard constructor. Windows and layers are both elements so everything in this section applies to both.</p>
<h3 id="constructing-elements">Constructing elements</h3>
<p>Unlike normal objects, elements have a single-form constructor which takes the <code>ui</code> singleton as arg#1 followed by any number of tables whose fields are first merged into a single table and then copied over to the element in lexicographic order. This means that:</p>
<ul>
<li>unknown fields are not discarded, which makes for a convenient way to create layers or windows with custom fields.</li>
<li>properties are set (i.e. setters are called) in a stable (albeit arbitrary) order.</li>
</ul>
<h3 id="styling">Styling</h3>
<p>Cascade styling is a mechanism for applying multiple attribute value sets to matching sets of elements based on matching tag combinations.</p>
<h4 id="tags">Tags</h4>
<p>Selecting elements is based on element tags only, which are equivalent to CSS classes (there is no concept of ids or other things to match on other than tags).</p>
<p>Elements can be initialized with the attribute <code>tags = 'tag1 tag2 ...'</code> similar to the html class attribute. Tags can also be added/removed later with <code>elem:settag(tagname, true|false)</code> or <code>elem:settags('+tag1 -tag2 ...')</code>. A class can also specify additional default tags with <code>myclass.tags = 'tag1 tag2 ...'</code>.</p>
<p>Tags matching the entire hierarchy of class names up to and including <code>'element'</code> are created automatically for each element, so every layer gets the <code>'element'</code> and <code>'layer'</code> tags, etc.</p>
<h4 id="selectors">Selectors</h4>
<p>Selectors are used in two contexts:</p>
<ul>
<li>creating styles with <code>ui:style()</code>.</li>
<li>finding elements with <code>ui|win:find()</code> and <code>ui|win:each()</code>.</li>
</ul>
<p>Selector syntax differs from CSS:</p>
<ul>
<li>simple selectors: <code>'tag1 tag2'</code> – in CSS: <code>.tag1.tag2</code></li>
<li>parent-child selectors: <code>'tag1 &gt; tag2'</code> – in CSS: <code>.tag1 .tag2</code></li>
<li>match missing tags: <code>'tag1 !tag2'</code> – in CSS: <code>tag1:not(.tag2)</code></li>
</ul>
<p>Selector objects are created with <code>ui:selector(select_text)</code>. It’s not normally necessary to create them explicitly (they are created automatically in places where a selector is expected), but they have additional methods:</p>
<ul>
<li><code>sel:filter(func)</code> – add a filter function <code>f(elem) -&gt; true|false</code> to the selector, to further filter the selected results; multiple filters can be added and they will be applied in order.</li>
<li><code>sel:selects(elem) -&gt; true|false</code> – test a selector against an element.</li>
</ul>
<p>Selector objects pass-through the selector constructor, which is short for saying that the selector constructor can take a selector object as arg#1 in which case the selector object is simply returned and no selector is created.</p>
<h4 id="styles">Styles</h4>
<p>Selector-based styles are created with <code>ui:style(selector, attr_values)</code> which adds them to the default stylesheet <code>ui.element.stylesheet</code>. Inline styles can be added with the <code>style</code> attribute when creating the element.</p>
<p>Styles are updated automatically on the next repaint. They can also be updated manually with <code>elem:sync_styles()</code>.</p>
<h4 id="stylesheets">Stylesheets</h4>
<ul>
<li>use <code>ss = ui:stylesheet()</code> to create a new stylesheet.</li>
<li>use <code>ss:style(selector, attr_values)</code> to add styles to it.</li>
<li>replace <code>ui.element.stylesheet</code> to change the styling of the entire app.</li>
<li>replace <code>ui.button.stylesheet</code> to change the styling of all buttons.</li>
<li>pass <code>stylesheet</code> when creating an element to set its stylesheet.</li>
<li>use <code>ss1:add_stylesheet(ss2)</code> to copy styles from another stylesheet.</li>
</ul>
<h4 id="state-tags">State tags</h4>
<p>Tags that start with <code>:</code> are <em>state tags</em> and are used exclusively for tagging element states like <code>:hot</code> and <code>:selected</code>.</p>
<p>Styles containing state tags are applied only after all styles containing only normal tags are applied. It’s as if styles containing state tags were added to a second stylesheet that was included after the default one. This allows overriding base styles without resetting any matching state styles, so for instance, declaring a new style for <code>'mybutton'</code> will not affect the syle set previously for <code>'mybutton :hot'</code>.</p>
<h4 id="finding-elements-using-selectors">Finding elements using selectors</h4>
<ul>
<li><code>ui|win|elem_list:find(sel) -&gt; elem_list</code> - find elements and return them in a list.</li>
<li><code>ui|win|elem_list:each(sel, func)</code> - run <code>func(elem)</code> for each element found.</li>
</ul>
<h3 id="transition-animations">Transition animations</h3>
<p>Transitions are about gradually changing the value of an element attribute from its current value to a new value using linear interpolation.</p>
<p>Every attribute can be animated providing it has a data type that can be interpolated. Currently, numbers, colors and color gradients can be interpolated, but more data types and interpolator functions can be added if needed (see the code for that).</p>
<p>Transitions can be created by calling:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb5-1"><a href="#cb5-1"></a>elem<span class="op">:</span>transition<span class="op">(</span>attr<span class="op">,</span> val<span class="op">,</span> <span class="op">[</span>duration<span class="op">],</span> <span class="op">[</span>ease<span class="op">],</span> <span class="op">[</span>delay<span class="op">],</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>  <span class="op">[</span>times<span class="op">],</span> <span class="op">[</span>backval<span class="op">],</span> <span class="op">[</span>blend<span class="op">],</span> <span class="op">[</span>speed<span class="op">],</span> <span class="op">[</span>from<span class="op">])</span></span></code></pre></div>
<p>or they can be defined declaratively as styles:</p>
<table>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>transition_&lt;attr&gt;</code></td>
<td></td>
<td>set to <code>true</code> to enable transitions for an attribute</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>transition_duration</code></td>
<td><code>0</code> (disabled)</td>
<td>animation duration (seconds)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>transition_ease</code></td>
<td><code>'expo out'</code></td>
<td>easing function and way (see <a href="/easing">easing</a>)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>transition_delay</code></td>
<td><code>0</code></td>
<td>delay before starting (seconds)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>transition_repeat</code></td>
<td><code>1</code></td>
<td>repeat times</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>transition_speed</code></td>
<td><code>1</code></td>
<td>speed factor</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>transition_blend</code></td>
<td><code>'replace'</code></td>
<td>blend function: <code>'replace'</code>, <code>'restart'</code>, <code>'wait'</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>transition_from</code></td>
<td><em>current value</em></td>
<td>start value</td>
</tr>
</tbody>
</table>
<p>Transition parameters can also be specified for each attribute with <code>transition_&lt;param&gt;_&lt;attr&gt;</code>, eg. <code>transition_duration_opacity = 2</code>.</p>
<p>Transitions are updated automatically on every repaint and are freed automatically when they finish. They can also be updated manually with <code>elem:sync_transitions()</code>.</p>
<h4 id="transition-blending">Transition blending</h4>
<p>Transition blending controls what happens when a transition is created over an attribute that is already in transition. Possible behaviors depend on the <code>transition_blend</code> attribute, which can be:</p>
<ul>
<li><code>'replace'</code> - replace current transition with the new one, but do nothing if the new transition has the same end value as the current one.</li>
<li><code>'replace_value'</code> - replace current transition’s end value, or create a new transition.</li>
<li><code>'restart'</code> - replace current transition with the new one, and also, start from the initial value instead of from the current value.</li>
<li><code>'wait'</code> - wait for the current transition to terminate before starting the new one, but do nothing if the new transition has the same end value as the current one.</li>
</ul>
<h3 id="ui-state">UI State</h3>
<table>
<tbody>
<tr class="odd">
<td style="text-align: left;">r/o property</td>
<td style="text-align: left;"><code>hot_widget</code></td>
<td style="text-align: left;">currently hot widget</td>
</tr>
<tr class="even">
<td style="text-align: left;">r/o property</td>
<td style="text-align: left;"><code>active_widget</code></td>
<td style="text-align: left;">currently active widget</td>
</tr>
<tr class="odd">
<td style="text-align: left;">r/o property</td>
<td style="text-align: left;"><code>dragged_widget</code></td>
<td style="text-align: left;">currently dragged widget</td>
</tr>
</tbody>
</table>
<h2 id="windows">Windows</h2>
<p>Like all elements, windows are created with <code>ui:window(attrs1, ...)</code>. Attributes can be passed in multiple initialization tables: the values in latter tables will take precedence over the values in former tables.</p>
<p>Windows are elements, so all element methods and properties apply.</p>
<h3 id="forwarded-properties-methods-and-events-1">Forwarded properties, methods and events</h3>
<p>Windows are a thin facade over <a href="/nw">nw</a> windows. Those features which map directly to nw window features are listed below but are not documented here again.</p>
<table>
<colgroup>
<col style="width: 49%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>native properties</strong></td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>x, y, w, h, cx, cy, cw, ch,</code> <code>min_cw, min_ch, max_cw, max_ch,</code> <code>autoquit, visible, fullscreen,</code> <code>enabled, edgesnapping, topmost,</code> <code>title, dead, closeable,</code> <code>activable, minimizable,</code> <code>maximizable, resizeable,</code> <code>hideonclose, fullscreenable, frame,</code> <code>transparent, corner_radius,</code> <code>sticky, dead, active, isminimized,</code> <code>ismaximized, display, cursor</code></td>
<td>these map directly to <a href="/nw">nw</a> window features except they are exposed as properties instead of methods like in <a href="/nw">nw</a>.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>native methods</strong></td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>close</code>, <code>free</code>, <code>frame_rect, client_rect,</code> <code>client_to_frame, frame_to_client,</code> <code>closing, close, show, hide,</code> <code>activate, minimize, maximize,</code> <code>restore, shownormal, raise, lower,</code> <code>to_screen, from_screen</code></td>
<td>these map directly to <a href="/nw">nw</a> window methods.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>native events</strong></td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>activated, deactivated, wakeup,</code> <code>shown, hidden,</code> <code>minimized, unminimized,</code> <code>maximized, unmaximized,</code> <code>entered_fullscreen,</code> <code>exited_fullscreen,</code> <code>changed, sizing,</code> <code>frame_rect_changed, frame_moved,</code> <code>frame_resized,</code> <code>client_moved, client_resized,</code> <code>magnets,</code> <code>free_cairo, free_bitmap,</code> <code>scalingfactor_changed</code></td>
<td>these map directly to <a href="/nw">nw</a> window events.</td>
</tr>
</tbody>
</table>
<h3 id="child-windows">Child windows</h3>
<p>A child window by <a href="/nw">nw</a>’s definition is a top-level window that does not appear in the taskbar and by default will follow its parent window when that is moved. That behavior is extended here so that a child window is positioned <em>relative to a layer</em> in another window so that it follows that layer even when the parent window itself doesn’t move but only the layer moves inside it.</p>
<table>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>win.parent</code></td>
<td style="text-align: left;">a layer in another window</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>win:to_parent(x, y) -&gt; x, y</code></td>
<td style="text-align: left;">window’s client space -&gt; its parent space</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>win:from_parent(x, y) -&gt; x, y</code></td>
<td style="text-align: left;">window’s parent space -&gt; its client space</td>
</tr>
</tbody>
</table>
<h3 id="pop-up-windows">Pop-up windows</h3>
<p>Pop-up windows are frameless, non-focusable, non-moveable child windows. They are created with <code>ui:popup(attrs1, ...)</code>. Clicking outside the pop-up area hides the pop-up, subject to the <code>autohide</code> property.</p>
<h3 id="moving-frameless-windows">Moving frameless windows</h3>
<p>For frameless windows, a layer (usually the layer representing the title bar) can be assigned to <code>win.move_layer</code> which will set it up to move the window when dragged.</p>
<h3 id="window-state">Window state</h3>
<table>
<tbody>
<tr class="odd">
<td style="text-align: left;">r/o property</td>
<td style="text-align: left;"><code>win.mouse_x, win.mouse_y</code></td>
<td>mouse position at the time of last mouse event</td>
</tr>
<tr class="even">
<td style="text-align: left;">method</td>
<td style="text-align: left;"><code>win:mouse_pos() -&gt; x, y</code></td>
<td>mouse position at the time of last mouse event</td>
</tr>
<tr class="odd">
<td style="text-align: left;">r/o property</td>
<td style="text-align: left;"><code>focused_widget</code></td>
<td>currently focused widget (<code>false</code> if none)</td>
</tr>
<tr class="even">
<td style="text-align: left;">tag</td>
<td style="text-align: left;"><code>:active</code></td>
<td>the window is active</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tag</td>
<td style="text-align: left;"><code>:fullscreen</code></td>
<td>the window is in fullscreen mode</td>
</tr>
</tbody>
</table>
<h2 id="layers">Layers</h2>
<p>Similar to HTML divs, layers encapsulate all the positioning, drawing, clipping, hit-testing and input infrastructure necessary for implementing widgets, and can also be used standalone as layout containers, text labels or other presentation elements.</p>
<p>Like all elements, layers are created with <code>ui:layer(attrs1, ...)</code>. Attributes can be passed in multiple initialization tables: the values in latter tables will take precedence over the values in former tables.</p>
<p>Layers are elements, so all element methods and properties apply.</p>
<h3 id="configuration">Configuration</h3>
<p>The following attributes can be used to initialize a layer and can also be changed freely at runtime to change its behavior or appearance.</p>
<table>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>layer hierarchy</strong></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>parent</code></td>
<td><code>false</code></td>
<td>parent: for positioning, painting and clipping</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>layer_index</code></td>
<td><code>1/0</code></td>
<td>preferred z-order: <code>1=backmost</code>, <code>1/0=frontmost</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>pos_parent</code></td>
<td><code>false</code></td>
<td>positioning parent (<code>false</code> means use <code>parent</code>)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>behavior</strong></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>visible</code></td>
<td><code>true</code></td>
<td>visible and occupies space in the layout</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>enabled</code></td>
<td><code>true</code></td>
<td>looks enabled and can receive input</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>activable</code></td>
<td><code>true</code></td>
<td>can be clicked and hovered (set as hot)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>vscrollable</code></td>
<td><code>false</code></td>
<td>enable mouse wheel when hot</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>hscrollable</code></td>
<td><code>false</code></td>
<td>enable mouse horiz. wheel when hot</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>focusable</code></td>
<td><code>false</code></td>
<td>can be focused</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>draggable</code></td>
<td><code>false</code></td>
<td>can be dragged</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>background_hittable</code></td>
<td><code>true</code></td>
<td>background area receives mouse input even when there’s no background</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>mousedown_activate</code></td>
<td><code>false</code></td>
<td>activate/deactivate on left mouse down/up</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>drag_threshold</code></td>
<td><code>0</code></td>
<td>moving distance before start dragging</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>[button]click_chain</code></td>
<td><code>1</code></td>
<td>2 for getting doubleclick events, etc.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>tabgroup</code></td>
<td><code>0</code></td>
<td>tab group, for tab-based navigation</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>tabindex</code></td>
<td><code>0</code></td>
<td>tab order in tab group, for tab-based navigation</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>taborder_algorithm</code></td>
<td><code>'xy'</code></td>
<td>tab order algorithm: <code>'xy'</code>, <code>'yx'</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>content box</strong></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>padding</code></td>
<td><code>0</code></td>
<td>padding for all sides</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>padding_&lt;side&gt;</code></td>
<td><code>false</code></td>
<td><code>left</code>/<code>right</code>/<code>top</code>/<code>bottom</code> padding override</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>layouting</strong></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>layout</code></td>
<td><code>false</code></td>
<td>layout model: <code>false</code> (none), <code>'textbox'</code>, <code>'flexbox'</code>, <code>'grid'</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>min_cw, min_ch</code></td>
<td><code>0</code></td>
<td>minimum content-box size for flexible layouts</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>snap_x</code>, <code>snap_y</code></td>
<td><code>true</code></td>
<td>snap <code>x, w, min_cw</code> and <code>y, h, min_ch</code> to pixels</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>layout=false</strong></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>x, y, w, h</code></td>
<td><code>0</code></td>
<td>fixed position &amp; size</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>flexbox &amp; grid layouts</strong></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>align_items_x</code>, <code>align_items_y</code></td>
<td><code>'stretch'</code></td>
<td><code>'stretch'</code>, <code>'start'</code>/<code>'top'</code>/<code>'left'</code>, <code>'end'</code>/<code>'bottom'</code>/<code>'right'</code>, <code>'center'</code>, <code>'space_between'</code>, <code>'space_around'</code>, <code>'space_evenly'</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>item_align_x</code>, <code>item_align_y</code></td>
<td><code>'stretch'</code></td>
<td><code>'stretch'</code>, <code>'start'</code>/<code>'top'</code>/<code>'left'</code>, <code>'end'</code>/<code>'bottom'</code>/<code>'right'</code>, <code>'center'</code>, <code>'baseline'</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>align_x</code>, <code>align_y</code></td>
<td><code>false</code></td>
<td>item override for <code>item_align_x</code> and <code>item_align_y</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>flexbox layout</strong></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>flex_flow</code></td>
<td><code>'x'</code></td>
<td>main axis of flow: <code>'x'</code>, <code>'y'</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>flex_wrap</code></td>
<td><code>false</code></td>
<td>line-wrap child layers</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fr</code></td>
<td><code>1</code></td>
<td>item stretch fraction for <code>'stretch'</code> alignments.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>grid layout</strong></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>grid_flow</code></td>
<td><code>'x'</code></td>
<td>main axis &amp; direction for automatic positioning: <code>'x'</code>, <code>'y'</code>, <code>'xr'</code>, <code>'yr'</code>, <code>'xb'</code>, <code>'yb'</code>, <code>'xrb'</code>, <code>'yrb'</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>grid_wrap</code></td>
<td><code>1</code></td>
<td>number of rows/columns on the main axis of flow</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>grid_cols</code></td>
<td><code>{}</code></td>
<td>column stretch fractions <code>{fr1, ...}</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>grid_rows</code></td>
<td><code>{}</code></td>
<td>row stretch fractions <code>{fr1, ...}</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>grid_gap</code></td>
<td><code>0</code></td>
<td>gap size between grid rows &amp; columns</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>grid_col_gap</code></td>
<td><code>false</code></td>
<td>override gap size for grid columns</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>grid_row_gap</code></td>
<td><code>false</code></td>
<td>override gap size for grid rows</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>grid_pos</code></td>
<td><code>nil</code></td>
<td>element position in grid: <code>'[row][/span] [col][/span]'</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>transparency &amp; clipping</strong></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>opacity</code></td>
<td><code>1</code></td>
<td>overall opacity in <code>0..1</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>clip_content</code></td>
<td><code>false</code></td>
<td>content clipping: <code>false</code> (don’t clip), <code>'padding'</code>/<code>true</code> (clip to content box), <code>'background'</code> (clip to background clip box)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>borders</strong></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>border_width</code></td>
<td><code>0</code></td>
<td>border thickness for all sides</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>border_width_&lt;side&gt;</code></td>
<td><code>false</code></td>
<td><code>left</code>/<code>right</code>/<code>top</code>/<code>bottom</code> border thickness override</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>corner_radius</code></td>
<td><code>0</code></td>
<td>border corner radius for all corners</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>corner_radius_&lt;corner&gt;</code></td>
<td><code>false</code></td>
<td><code>top_left</code>/<code>top_right</code>/<code>bottom_left</code>/<code>bottom_right</code> corner radius override</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>border_color</code></td>
<td><code>'#fff'</code></td>
<td>border color</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>border_color_&lt;side&gt;</code></td>
<td><code>false</code></td>
<td><code>left</code>/<code>right</code>/<code>top</code>/<code>bottom</code> border color override</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>border_dash</code></td>
<td><code>false</code></td>
<td>border dash pattern: <code>{length1, ...}</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>border_offset</code></td>
<td><code>-1</code></td>
<td>border stroke position rel. to box edge (-1=inside..1=outside)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>corner_radius_kappa</code></td>
<td><code>1.2</code></td>
<td>smoother rounded corners (1=circle arc)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>background</strong></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>background_type</code></td>
<td><code>'color'</code></td>
<td><code>false</code>, <code>'color'</code>, <code>'gradient'</code>, <code>'radial_gradient'</code>, <code>'image'</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>background_x/y</code></td>
<td><code>0</code></td>
<td>background offset coords</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>background_rotation</code></td>
<td><code>0</code></td>
<td>background rotation angle (radians)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>background_rotation_cx/cy</code></td>
<td><code>0</code></td>
<td>background rotation center coords</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>background_scale</code></td>
<td><code>1</code></td>
<td>background scale factor</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>background_scale_cx/cy</code></td>
<td><code>0</code></td>
<td>background scale center coords</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>background_operator</code></td>
<td><code>'over'</code></td>
<td>cairo blending operator</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>background_clip_border_offset</code></td>
<td><code>1</code></td>
<td>like <code>border_offset</code> but for clipping the background</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>background_color</code></td>
<td><code>false</code></td>
<td>background color</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>background_colors</code></td>
<td><code>false</code></td>
<td>gradient: <code>{[offset1], color1, ...}</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>background_x1/y1/x2/y2</code></td>
<td><code>0</code></td>
<td>linear gradient: end-point coords</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>background_cx1/cy1/cx2/cy2</code></td>
<td><code>0</code></td>
<td>radial gradient: end-point coords</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>background_r1/r2</code></td>
<td><code>0</code></td>
<td>radial gradient: radii</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>background_image</code></td>
<td><code>false</code></td>
<td>background image file (requires <a href="/libjpeg">libjpeg</a>)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>background_image_format</code></td>
<td><code>'%s'</code></td>
<td>string.format() template for <code>background_image</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>shadow</strong></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>shadow_x, shadow_y</code></td>
<td><code>0</code></td>
<td>shadow offset coords</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>shadow_color</code></td>
<td><code>'#000'</code></td>
<td>shadow color</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>shadow_blur</code></td>
<td><code>0</code></td>
<td>shadow blur size (0=disable)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>text</strong></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>text</code></td>
<td><code>false</code></td>
<td>text, wrapped around <code>cw</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>font</code></td>
<td><code>'Open Sans,14'</code></td>
<td>font spec: <code>'name [weight] [slant][, size]'</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>font_name</code></td>
<td><code>false</code></td>
<td>font name override</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>font_weight</code></td>
<td><code>false</code></td>
<td>font weight override: <code>100..900</code>, <code>'bold'</code>, etc.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>font_slant</code></td>
<td><code>false</code></td>
<td>font slant override: <code>'italic'</code>, <code>'normal'</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>font_size</code></td>
<td><code>false</code></td>
<td>font size override</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>text_color</code></td>
<td><code>'#fff'</code></td>
<td>text color</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>line_spacing</code></td>
<td><code>1</code></td>
<td>multiply factor over line height for lines</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>paragraph_spacing</code></td>
<td><code>2</code></td>
<td>multiply factor over line height for paragraphs</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>text_dir</code></td>
<td><code>'auto'</code></td>
<td>BiDi base direction: <code>'auto'</code>, <code>'rtl'</code>, <code>'ltr'</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>nowrap</code></td>
<td><code>false</code></td>
<td>disable automatic line wrapping</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>text_operator</code></td>
<td><code>'over'</code></td>
<td>blending operator (see <a href="/cairo">cairo</a>)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>text_align_x</code></td>
<td><code>'center'</code></td>
<td>text x-align: <code>'left'</code>, <code>'center'</code>, <code>'right'</code>, <code>'auto'</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>text_align_y</code></td>
<td><code>'center'</code></td>
<td>text y-align: <code>'top'</code>, <code>'center'</code>, <code>'bottom'</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>cursor</strong></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>cursor</code></td>
<td><code>'arrow'</code></td>
<td>default mouse cursor (see <a href="/nw">nw</a> for values)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>cursor_&lt;area&gt;</code></td>
<td><code>nil</code></td>
<td>mouse cursor for an area</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>tooltip</strong></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>tooltip</code></td>
<td><code>false</code></td>
<td>native tooltip text (false=none)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>rotation &amp; scaling</strong></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>rotation</code></td>
<td><code>0</code></td>
<td>rotation angle (radians)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>rotation_cx, rotation_cy</code></td>
<td><code>0</code></td>
<td>rotation center coordinates</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>scale</code></td>
<td><code>1</code></td>
<td>scale factor</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>scale_cx, scale_cy</code></td>
<td><code>0</code></td>
<td>scale center coords</td>
</tr>
</tbody>
</table>
<h3 id="box-model">Box model</h3>
<h4 id="layer-hierarchy">Layer hierarchy</h4>
<ul>
<li>layers can be nested, which affects their painting order, clipping and positioning relative to each other.</li>
<li>layers can be atteched to a parent layer by specifying a <code>parent</code>.</li>
<li><code>parent</code> can be set to a window object, in which case the window will change it to point to its <code>view</code> layer.</li>
<li>layers can be moved to another parent after creation by changing their <code>parent</code> property.</li>
<li>child layers can be specified in the array parts of the init tables, either as plain tables with a <code>class</code> attribute or pre-created.</li>
</ul>
<h4 id="size-positioning">Size &amp; positioning</h4>
<ul>
<li>layers have a “box” defined by <code>x, y, w, h</code> and a “content box” (or “client rectangle”) which is the same box adjusted by paddings.</li>
<li>layers are positioned relative to their parent’s <em>content box</em>.</li>
<li><code>x, y, w, h</code> are input fields (user must set their values) only when layouting is disabled on a layer and its parent. When a layout model is used, those fields are controlled by the layout.</li>
<li>setting <code>cw, ch, cx, cy, x2, y2</code> only sets <code>x, y, w, h</code> indirectly.</li>
</ul>
<h4 id="z-order">Z-order</h4>
<ul>
<li>a layer keeps its children in its array part which also dictates their painting order: first child is painted first.</li>
<li>setting the <code>parent</code> property adds the layer to the end of its new parent’s child list.</li>
<li>layers can change their paint order with <code>to_front()</code>, <code>to_back()</code> or by setting their <code>layer_index</code> property directly.</li>
<li>you can sort a layer’s children by sorting the layer itself with <code>table.sort()</code>.</li>
<li><code>layer_index</code> represents a preferred index when constructing a layer, but at runtime it always reflects the actual index in the parent array.</li>
</ul>
<h4 id="borders">Borders</h4>
<ul>
<li>unlike HTML, the content box is <em>not</em> affected by borders!</li>
<li>the offset at which the border is drawn relative to the layer’s box can be controlled with the <code>border_offset</code> property where <code>-1</code> draws an inner border, <code>1</code> draws an outer border, and <code>0</code> draws a stroke with its median line coinciding with the box (so half-in half-out).</li>
</ul>
<h4 id="clipping">Clipping</h4>
<ul>
<li>a layer’s contents can be clipped by its padding box, by the inner contour of its border, or it can be left unclipped, courtesy of the <code>clip_content</code> property.</li>
<li>a layer’s background is always clipped.</li>
</ul>
<h3 id="box-model-api">Box model API</h3>
<table>
<tbody>
<tr class="odd">
<td></td>
<td style="text-align: left;"><strong>layer hierarchy &amp; z-order</strong></td>
<td></td>
</tr>
<tr class="even">
<td>r/w property</td>
<td style="text-align: left;"><code>parent</code></td>
<td>layer’s parent</td>
</tr>
<tr class="odd">
<td>r/o property</td>
<td style="text-align: left;"><code>window</code></td>
<td>layer’s window</td>
</tr>
<tr class="even">
<td>r/w property</td>
<td style="text-align: left;"><code>layer_index</code></td>
<td>index in parent array (z-order)</td>
</tr>
<tr class="odd">
<td>method</td>
<td style="text-align: left;"><code>to_back()</code></td>
<td>set <code>layer_index</code> to <code>1</code></td>
</tr>
<tr class="even">
<td>method</td>
<td style="text-align: left;"><code>to_front()</code></td>
<td>set <code>layer_index</code> to <code>1/0</code></td>
</tr>
<tr class="odd">
<td>method</td>
<td style="text-align: left;"><code>each_child(func)</code></td>
<td>call <code>func(layer)</code> for each child recursively depth-first</td>
</tr>
<tr class="even">
<td>method</td>
<td style="text-align: left;"><code>children() -&gt; iter() -&gt; layer</code></td>
<td>iterate children recursively depth-first</td>
</tr>
<tr class="odd">
<td>event</td>
<td style="text-align: left;"><code>layer_added(layer, index)</code></td>
<td>a child layer was added</td>
</tr>
<tr class="even">
<td>event</td>
<td style="text-align: left;"><code>layer_removed(layer)</code></td>
<td>a child layer was removed</td>
</tr>
<tr class="odd">
<td></td>
<td style="text-align: left;"><strong>size &amp; positioning</strong></td>
<td></td>
</tr>
<tr class="even">
<td>plain field</td>
<td style="text-align: left;"><code>x, y, w, h</code></td>
<td>computed box size and position</td>
</tr>
<tr class="odd">
<td>r/w property</td>
<td style="text-align: left;"><code>cw, ch</code></td>
<td>content box size</td>
</tr>
<tr class="even">
<td>r/w property</td>
<td style="text-align: left;"><code>cx, cy</code></td>
<td>box’s center coords</td>
</tr>
<tr class="odd">
<td>r/w property</td>
<td style="text-align: left;"><code>x2, y2</code></td>
<td>box’s bottom-right corner coords</td>
</tr>
<tr class="even">
<td>r/o property</td>
<td style="text-align: left;"><code>pw, ph</code></td>
<td>total horizontal and vertical paddings</td>
</tr>
<tr class="odd">
<td>r/o property</td>
<td style="text-align: left;"><code>pw1, pw2, ph1, ph2</code></td>
<td>paddings for each side</td>
</tr>
<tr class="even">
<td>r/o property</td>
<td style="text-align: left;"><code>inner_x/y/w/h</code></td>
<td>border’s inner contour box</td>
</tr>
<tr class="odd">
<td>r/o property</td>
<td style="text-align: left;"><code>outer_x/y/w/h</code></td>
<td>border’s outer contour box</td>
</tr>
<tr class="even">
<td>r/o property</td>
<td style="text-align: left;"><code>baseline</code></td>
<td>text’s baseline</td>
</tr>
<tr class="odd">
<td>method</td>
<td style="text-align: left;"><code>size() -&gt; w, h</code></td>
<td>box size</td>
</tr>
<tr class="even">
<td>method</td>
<td style="text-align: left;"><code>client_size() -&gt; cw, ch</code></td>
<td>content box size</td>
</tr>
<tr class="odd">
<td>method</td>
<td style="text-align: left;"><code>padding_size() -&gt; cw, ch</code></td>
<td>content box size</td>
</tr>
<tr class="even">
<td>method</td>
<td style="text-align: left;"><code>client_rect() -&gt; 0, 0, cw, ch</code></td>
<td>content box rect in content box space</td>
</tr>
<tr class="odd">
<td></td>
<td style="text-align: left;"><strong>space conversion</strong></td>
<td></td>
</tr>
<tr class="even">
<td>method</td>
<td style="text-align: left;"><code>from_box_to_parent  (x, y) -&gt; x, y</code></td>
<td>own box space -&gt; parent content space</td>
</tr>
<tr class="odd">
<td>method</td>
<td style="text-align: left;"><code>from_parent_to_box  (x, y) -&gt; x, y</code></td>
<td>parent content space -&gt; own box space</td>
</tr>
<tr class="even">
<td>method</td>
<td style="text-align: left;"><code>to_parent           (x, y) -&gt; x, y</code></td>
<td>own content space -&gt; parent content space</td>
</tr>
<tr class="odd">
<td>method</td>
<td style="text-align: left;"><code>from_parent         (x, y) -&gt; x, y</code></td>
<td>parent content space -&gt; own content space</td>
</tr>
<tr class="even">
<td>method</td>
<td style="text-align: left;"><code>to_window           (x, y) -&gt; x, y</code></td>
<td>own content space -&gt; window’s content space</td>
</tr>
<tr class="odd">
<td>method</td>
<td style="text-align: left;"><code>from_window         (x, y) -&gt; x, y</code></td>
<td>window’s content space -&gt; own content space</td>
</tr>
<tr class="even">
<td>method</td>
<td style="text-align: left;"><code>to_screen           (x, y) -&gt; x, y</code></td>
<td>own content space -&gt; screen space</td>
</tr>
<tr class="odd">
<td>method</td>
<td style="text-align: left;"><code>from_screen         (x, y) -&gt; x, y</code></td>
<td>screen space -&gt; own content space</td>
</tr>
<tr class="even">
<td>method</td>
<td style="text-align: left;"><code>to_other    (widget, x, y) -&gt; x, y</code></td>
<td>own content space -&gt; other’s content space</td>
</tr>
<tr class="odd">
<td>method</td>
<td style="text-align: left;"><code>from_other  (widget, x, y) -&gt; x, y</code></td>
<td>other’s content space -&gt; own content space</td>
</tr>
<tr class="even">
<td>method</td>
<td style="text-align: left;"><code>bbox_in(parent,x1,y1,...) -&gt; x,y,w,h</code></td>
<td>bounding box of a list of points in another layer’s content box</td>
</tr>
</tbody>
</table>
<h3 id="input-model">Input model</h3>
<h4 id="mouse-interaction">Mouse interaction</h4>
<ul>
<li>layers must be set <code>activable</code> in order to receive mouse events.</li>
<li>an activable layer becomes <code>hot</code> when the mouse is over it.</li>
<li>a layer can capture mouse movements while a mouse button is down by setting its <code>active</code> property on <code>mousedown</code> and clearing it on <code>mouseup</code>. this will be done automatically if <code>mousedown_activate</code> is set.</li>
<li>while a layer is <code>active</code>, it continues to be <code>hot</code> and receive <code>mousemove</code> events even when the mouse is outside its hit-test area or outside the window even (that is, the mouse is captured).</li>
<li><code>click_chain</code> controls how many repeated clicks are to be taken as one single click chain (a double-click, triple-click or quadruple-click). if set to 1 for instance, double-clicks are never received.</li>
</ul>
<h4 id="keyboard-interaction">Keyboard interaction</h4>
<ul>
<li>layers must be set <code>focusable</code> in order to receive keyboard events.</li>
<li>keyboard events are received by the focused layer first and bubble up to all its parents up to its window.</li>
<li>return <code>true</code> in a <code>keydown</code> event to eat up a key stroke so that it isn’t used by other actions: this is how key conflicts are solved.</li>
</ul>
<h4 id="drag-drop">Drag &amp; drop</h4>
<ul>
<li>a layer must set the <code>draggable</code> flag to enable dragging.</li>
<li>a layer must be in <code>active</code> state for dragging to work.</li>
<li>when the user starts dragging a layer, the <code>start_drag()</code> method is called on the layer (which by default returns <code>self</code>). Draggable layers must implement this method to return the layer that is to be dragged (could be <code>self</code> or other layer) and an optional “grab position” inside that layer. If a layer is returned, a dragging operation starts and the <code>started_dragging()</code> event is fired on the dragged layer.</li>
<li>when the dragging operation starts, all visible and enabled layers from all windows are asked to <code>accept_drag_widget()</code>. Those that can be a drop target for the dragged layer must return <code>true</code> (the default implementation does not return anything) after which the dragged layer is asked to <code>accept_drop_widget()</code> too (the default implementation returns <code>true</code>). The potential drop targets then get the <code>:drop_target</code> tag.</li>
<li>when the layer is dragged over an accepting layer, <code>accept_drag_widget()</code> and <code>accept_drop_widgets()</code> are called again on the respective layers, this time with a mouse position and target area. If these calls both return <code>true</code>, the dragged layer receives the <code>enter_drop_target()</code> event.</li>
<li>when the mouse is depressed over a drop target, the drop target receives the <code>drop()</code> event, the dragged layer receives the <code>ended_dragging()</code> event, and the initiating layer receives the <code>end_drag()</code> event.</li>
</ul>
<h3 id="input-model-api">Input model API</h3>
<table>
<tbody>
<tr class="odd">
<td></td>
<td style="text-align: left;"><strong>enabled state</strong></td>
<td></td>
</tr>
<tr class="even">
<td>r/w property</td>
<td style="text-align: left;"><code>enabled</code></td>
<td>enabled and all parents are enabled too</td>
</tr>
<tr class="odd">
<td>tag</td>
<td style="text-align: left;"><code>:enabled</code></td>
<td><code>enabled</code> property is set</td>
</tr>
<tr class="even">
<td></td>
<td style="text-align: left;"><strong>hot state</strong></td>
<td></td>
</tr>
<tr class="odd">
<td>r/o property</td>
<td style="text-align: left;"><code>hot</code></td>
<td>mouse pointer is over the layer (or the layer is active)</td>
</tr>
<tr class="even">
<td>tag</td>
<td style="text-align: left;"><code>:hot</code></td>
<td>layer is hot</td>
</tr>
<tr class="odd">
<td>tag</td>
<td style="text-align: left;"><code>:hot_&lt;area&gt;</code></td>
<td>layer is hot on a specific area</td>
</tr>
<tr class="even">
<td></td>
<td style="text-align: left;"><strong>active state</strong></td>
<td></td>
</tr>
<tr class="odd">
<td>r/w property</td>
<td style="text-align: left;"><code>active</code></td>
<td>mouse is captured</td>
</tr>
<tr class="even">
<td>tag</td>
<td style="text-align: left;"><code>:active</code></td>
<td>layer is active</td>
</tr>
<tr class="odd">
<td>event</td>
<td style="text-align: left;"><code>activated()</code></td>
<td>layer was activated</td>
</tr>
<tr class="even">
<td>event</td>
<td style="text-align: left;"><code>deactivated()</code></td>
<td>layer was deactivated</td>
</tr>
<tr class="odd">
<td></td>
<td style="text-align: left;"><strong>mouse events &amp; state</strong></td>
<td></td>
</tr>
<tr class="even">
<td>event</td>
<td style="text-align: left;"><code>mousemove(x, y, area)</code></td>
<td>mouse moved over a layer area</td>
</tr>
<tr class="odd">
<td>event</td>
<td style="text-align: left;"><code>mouseenter(x, y, area)</code></td>
<td>mouse entered the layer area</td>
</tr>
<tr class="even">
<td>event</td>
<td style="text-align: left;"><code>mouseleave()</code></td>
<td>mouse left the layer area</td>
</tr>
<tr class="odd">
<td>event</td>
<td style="text-align: left;"><code>[button]mousedown(x, y, area)</code></td>
<td>mouse button pressed</td>
</tr>
<tr class="even">
<td>event</td>
<td style="text-align: left;"><code>[button]mouseup(x, y, area)</code></td>
<td>mouse button depressed</td>
</tr>
<tr class="odd">
<td>event</td>
<td style="text-align: left;"><code>[button]click(x, y, area)</code></td>
<td>mouse button click</td>
</tr>
<tr class="even">
<td>event</td>
<td style="text-align: left;"><code>[button]doubleclick(x, y, area)</code></td>
<td>mouse button double-click</td>
</tr>
<tr class="odd">
<td>event</td>
<td style="text-align: left;"><code>[button]tripleclick(x, y, area)</code></td>
<td>mouse button triple-click</td>
</tr>
<tr class="even">
<td>event</td>
<td style="text-align: left;"><code>[button]quadrupleclick(x, y, area)</code></td>
<td>mouse button quadruple-click</td>
</tr>
<tr class="odd">
<td>event</td>
<td style="text-align: left;"><code>mousewheel(delta, x, y, area, pdelta)</code></td>
<td>mouse wheel moved <code>delta</code> notches</td>
</tr>
<tr class="even">
<td>event</td>
<td style="text-align: left;"><code>&lt;event&gt;_&lt;area&gt;(...)</code></td>
<td>mouse event over area (all except mouseenter and mouseleave)</td>
</tr>
<tr class="odd">
<td>r/o property</td>
<td style="text-align: left;"><code>mouse_x, mouse_y</code></td>
<td>mouse coords from the last mouse event</td>
</tr>
<tr class="even">
<td></td>
<td style="text-align: left;"><strong>focused state</strong></td>
<td></td>
</tr>
<tr class="odd">
<td>r/o property</td>
<td style="text-align: left;"><code>focused</code></td>
<td>layer has keyboard focus</td>
</tr>
<tr class="even">
<td>tag</td>
<td style="text-align: left;"><code>:focused</code></td>
<td>layer is focused</td>
</tr>
<tr class="odd">
<td>tag</td>
<td style="text-align: left;"><code>:child_focused</code></td>
<td>layer is a parent of a layer that has focus</td>
</tr>
<tr class="even">
<td>method</td>
<td style="text-align: left;"><code>focus()</code></td>
<td>focus the layer</td>
</tr>
<tr class="odd">
<td>method</td>
<td style="text-align: left;"><code>unfocus()</code></td>
<td>unfocus the layer</td>
</tr>
<tr class="even">
<td>event</td>
<td style="text-align: left;"><code>gotfocus()</code></td>
<td>layer was focused</td>
</tr>
<tr class="odd">
<td>event</td>
<td style="text-align: left;"><code>lostfocus()</code></td>
<td>layer was unfocused</td>
</tr>
<tr class="even">
<td>tag</td>
<td style="text-align: left;"><code>:window_active</code></td>
<td>layer has focus and window is active</td>
</tr>
<tr class="odd">
<td>event</td>
<td style="text-align: left;"><code>window_activated()</code></td>
<td>window was activated while layer has focus</td>
</tr>
<tr class="even">
<td>event</td>
<td style="text-align: left;"><code>window_deactivated()</code></td>
<td>window was deactivated while layer has focus</td>
</tr>
<tr class="odd">
<td></td>
<td style="text-align: left;"><strong>keyboard events</strong></td>
<td></td>
</tr>
<tr class="even">
<td>event</td>
<td style="text-align: left;"><code>keydown(key)</code></td>
<td>a key was pressed</td>
</tr>
<tr class="odd">
<td>event</td>
<td style="text-align: left;"><code>keyup(key)</code></td>
<td>a key was released</td>
</tr>
<tr class="even">
<td>event</td>
<td style="text-align: left;"><code>keypress(key)</code></td>
<td>a key was pressed (on repeat)</td>
</tr>
<tr class="odd">
<td>event</td>
<td style="text-align: left;"><code>keychar(s)</code></td>
<td>an utf-8 sequence was entered</td>
</tr>
<tr class="even">
<td></td>
<td style="text-align: left;"><strong>drag &amp; drop</strong></td>
<td></td>
</tr>
<tr class="odd">
<td>stub method</td>
<td style="text-align: left;"><code>start_drag(button, mx, my, area)</code></td>
<td>called on dragging layer to start dragging</td>
</tr>
<tr class="even">
<td>stub method</td>
<td style="text-align: left;"><code>accept_drag_widget(widget, mx, my, area)</code></td>
<td>called on drop target to accept the payload</td>
</tr>
<tr class="odd">
<td>stub method</td>
<td style="text-align: left;"><code>accept_drop_widget(widget, area)</code></td>
<td>called on dragged layer accept the target</td>
</tr>
<tr class="even">
<td>event</td>
<td style="text-align: left;"><code>started_dragging()</code></td>
<td>fired on dragged layer after dragging started</td>
</tr>
<tr class="odd">
<td>event</td>
<td style="text-align: left;"><code>drag(x, y)</code></td>
<td>fired on dragged layer while dragging</td>
</tr>
<tr class="even">
<td>event</td>
<td style="text-align: left;"><code>enter_drop_target(widget, area)</code></td>
<td>fired on dragged layer when entering a target</td>
</tr>
<tr class="odd">
<td>event</td>
<td style="text-align: left;"><code>leave_drop_target(widget)</code></td>
<td>fired on dragged layer when leaving a target</td>
</tr>
<tr class="even">
<td>event</td>
<td style="text-align: left;"><code>drop(widget, x, y, area)</code></td>
<td>fired on drop target to perform the drop</td>
</tr>
<tr class="odd">
<td>event</td>
<td style="text-align: left;"><code>ended_dragging()</code></td>
<td>fired on dragged layer after dragging ended</td>
</tr>
<tr class="even">
<td>event</td>
<td style="text-align: left;"><code>end_drag(drag_widget)</code></td>
<td>called on initiating layer after dragging ended</td>
</tr>
<tr class="odd">
<td>r/o property</td>
<td style="text-align: left;"><code>dragging</code></td>
<td>layer is being dragged</td>
</tr>
<tr class="even">
<td>r/o property</td>
<td style="text-align: left;"><code>floating</code></td>
<td>layer is being dragged or its box is animating</td>
</tr>
<tr class="odd">
<td>tag</td>
<td style="text-align: left;"><code>:dragging</code></td>
<td>layer is being dragged</td>
</tr>
<tr class="even">
<td>tag</td>
<td style="text-align: left;"><code>:dropping</code></td>
<td>dragged layer is over a drop target</td>
</tr>
<tr class="odd">
<td>tag</td>
<td style="text-align: left;"><code>:drop_target</code></td>
<td>layer is a potential drop target</td>
</tr>
<tr class="even">
<td>tag</td>
<td style="text-align: left;"><code>:drag_source</code></td>
<td>dragging was initiated from this layer</td>
</tr>
</tbody>
</table>
<h3 id="layouting">Layouting</h3>
<p>Layouting deals with sizing and positioning layers automatically to accommodate both the content size and the window size. Layouting is enabled via the <code>layout</code> attribute. Layers with different layout types and properties can be mixed freely in a layer hierarchy with some caveats, as explained below.</p>
<h4 id="no-layout">No layout</h4>
<p>Layers without a layout (<code>layout = false</code>) don’t position or size themselves or their children, but instead ask their children to lay themselves out according to their own <code>layout</code> setting.</p>
<p>No-layout children of no-layout parents <em>are not</em> sized by their parent and do not size themselves either, thus these layers must be sized and positioned manually by setting their <code>x, y, w, h</code>.</p>
<p>Layouted children of no-layout layers <em>are not</em> sized by their parent and must thus set their <code>min_cw, min_ch</code>, otherwise they will size themselves to the minimum allowed by their children.</p>
<p>No-layout children of layouted parents <em>are</em> sized by their parent and must thus set their <code>min_cw, min_ch</code>, otherwise they may shrink to nothing since they don’t size themselves to contain their content.</p>
<h4 id="textbox-layouts">Textbox layouts</h4>
<p>Freestanding textbox layers (whose parent is not layouted) size themselves to contain their <code>text</code> property which is line-wrapped on their <code>min_cw</code>.</p>
<h4 id="flexbox-layouts">Flexbox layouts</h4>
<p>Flexbox layers use an algorithm similar to the CSS flexbox algorithm to size themselves and to size and position their children recursively.</p>
<h4 id="grid-layouts">Grid layouts</h4>
<p>Grid layers use an algorithm similar to the CSS grid algorithm to size themselves and to size and position their children recursively.</p>
<h4 id="wrapping-layouts">Wrapping layouts</h4>
<p>Layouts with wrapping content (<code>nowrap = false</code>, <code>flex_wrap = true</code>) are solved on one axis completely before solving on the other axis. This only works properly if all the wrappable content has either horizontal flow (so the whole layout is <em>width-in-height-out</em>) or vertical flow (so the whole layout is <em>height-in-width-out</em>). Mixed flows will cause the contents which wrap perpendicularly to the main flow to overflow their container (browsers have this limitation too). Setting <code>min_cw, min_ch</code> on the cross-flow layers can be used to alleviate the problem on a case-by-case basis.</p>
<h3 id="the-top-layer">The top layer</h3>
<p>Windows have a top layer in their <code>view</code> field. Its size is kept in sync with the window’s client area and it’s configured to clear the window’s bitmap on every repaint with these settings:</p>
<ul>
<li><code>background_color = '#040404f0'</code></li>
<li><code>background_operator = 'source'</code></li>
</ul>
<p>User-created layers must ultimately be attached to the window’s view (or to the window itself which will attach them to the window’s view) in order to be visible and respond to user input. The window view is the only layer whose <code>parent</code> is a window object, not another layer.</p>
<h2 id="widgets">Widgets</h2>
<p>Widgets are layers (usually containing other layers) with custom styling and behavior and additional properties, methods and events. Widgets can be extended by subclassing and method overriding and can be over-styled with <code>ui:style()</code> or by assigning them a different stylesheet.</p>
<p>The methods below are actually widget classes used as methods (see the <a href="/oo">oo</a> section on virtual classes), so <code>ui.button</code> is the button class, etc.</p>
<table>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>input widgets</strong></td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;"><a href="#buttons"><code>ui:button(...)</code></a></td>
<td>create a button</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><a href="#menus"><code>ui:menu(...)</code></a></td>
<td>create a menu</td>
</tr>
<tr class="even">
<td style="text-align: left;"><a href="#editboxes"><code>ui:editbox(...)</code></a></td>
<td>create an editbox</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><a href="#drop-downs"><code>ui:dropdown(...)</code></a></td>
<td>create a drop-down</td>
</tr>
<tr class="even">
<td style="text-align: left;"><a href="#sliders"><code>ui:slider(...)</code></a></td>
<td>create a slider</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><a href="#toggle-buttons"><code>ui:toggle(...)</code></a></td>
<td>create a toggle button</td>
</tr>
<tr class="even">
<td style="text-align: left;"><a href="#checkboxes"><code>ui:checkbox(...)</code></a></td>
<td>create a check box</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><a href="#radio-buttons"><code>ui:radiobutton(...)</code></a></td>
<td>create a radio button</td>
</tr>
<tr class="even">
<td style="text-align: left;"><a href="#choice-buttons"><code>ui:choicebutton(...)</code></a></td>
<td>create a choice button</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><a href="#color-pickers"><code>ui:colorpicker(...)</code></a></td>
<td>create a color picker</td>
</tr>
<tr class="even">
<td style="text-align: left;"><a href="#calendars"><code>ui:calendar(...)</code></a></td>
<td>create a calendar</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>output widgets</strong></td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;"><a href="#progress-bars"><code>ui:progressbar(...)</code></a></td>
<td>create a progress bar</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>input/output widgets</strong></td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;"><a href="#editable-grids"><code>ui:grid(...)</code></a></td>
<td>create a grid</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>containers</strong></td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;"><a href="#scroll-bars"><code>ui:scrollbar(...)</code></a></td>
<td>create a scroll bar</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><a href="#scroll-boxes"><code>ui:scrollbox(...)</code></a></td>
<td>create a scroll box</td>
</tr>
<tr class="even">
<td style="text-align: left;"><a href="#pop-up-windows"><code>ui:popup(...)</code></a></td>
<td>create a pop-up window</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><a href="#tab-lists"><code>ui:tablist(...)</code></a></td>
<td>create a tab list</td>
</tr>
</tbody>
</table>
<p><strong>TIP:</strong> Widgets are implemented in separate modules. Run each module as a standalone script to see a demo of the widgets implemented in the module.</p>
<h2 id="buttons">Buttons</h2>
<p>Buttons are created with <code>ui:button(attrs1, ...)</code>.</p>
<table>
<tbody>
<tr class="odd">
<td>r/w property</td>
<td style="text-align: left;"><code>default</code></td>
<td style="text-align: left;"><code>false</code></td>
<td>pressing Enter anywhere presses the button</td>
</tr>
<tr class="even">
<td>r/w property</td>
<td style="text-align: left;"><code>cancel</code></td>
<td style="text-align: left;"><code>false</code></td>
<td>pressing Esc anywhere presses the button</td>
</tr>
<tr class="odd">
<td>r/w property</td>
<td style="text-align: left;"><code>profile</code></td>
<td style="text-align: left;"><code>false</code></td>
<td>style profile: <code>false</code>, <code>'text'</code></td>
</tr>
<tr class="even">
<td>r/w property</td>
<td style="text-align: left;"><code>key</code></td>
<td style="text-align: left;"><code>false</code></td>
<td>key shortcut (see <code>app:key()</code> in <a href="/nw">nw</a>)</td>
</tr>
<tr class="odd">
<td>tag</td>
<td style="text-align: left;"><code>:over</code></td>
<td style="text-align: left;"></td>
<td>the button is pressed and the mouse is over the button</td>
</tr>
<tr class="even">
<td>event</td>
<td style="text-align: left;"><code>pressed()</code></td>
<td style="text-align: left;"></td>
<td>the button was pressed</td>
</tr>
</tbody>
</table>
<h2 id="menus">Menus</h2>
<p>Menus are created with <code>ui:menu(attrs1, ...)</code>.</p>
<table>
<tbody>
<tr class="odd">
<td style="text-align: left;">TODO</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="editboxes">Editboxes</h2>
<p>Editboxes are created with <code>ui:editbox(attrs1, ...)</code>.</p>
<table>
<tbody>
<tr class="odd">
<td><strong>behavior</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>r/w property</td>
<td><code>password</code></td>
<td><code>false</code></td>
<td>mask characters</td>
</tr>
<tr class="odd">
<td>r/w property</td>
<td><code>maxlen</code></td>
<td><code>4096</code></td>
<td>max text length in codepoints</td>
</tr>
<tr class="even">
<td>r/w property</td>
<td><code>multiline</code></td>
<td></td>
<td>multi-line scrollable editbox</td>
</tr>
<tr class="odd">
<td><strong>styling</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>tag</td>
<td><code>multiline</code></td>
<td></td>
<td>editbox is multi-line</td>
</tr>
<tr class="odd">
<td>tag</td>
<td><code>:insert_mode</code></td>
<td></td>
<td>editor is in insert mode</td>
</tr>
<tr class="even">
<td>r/w property</td>
<td><code>caret_color</code></td>
<td><code>'#fff'</code></td>
<td>caret fill color</td>
</tr>
<tr class="odd">
<td>r/w property</td>
<td><code>caret_opacity</code></td>
<td>`1</td>
<td>caret opacity</td>
</tr>
<tr class="even">
<td>r/w property</td>
<td><code>selection_color</code></td>
<td><code>'#66f8'</code></td>
<td>selection fill color</td>
</tr>
<tr class="odd">
<td>__hit testing</td>
<td>__</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>hittest area</td>
<td><code>text</code></td>
<td></td>
<td>area over unselected text</td>
</tr>
<tr class="odd">
<td>hittest area</td>
<td><code>selection</code></td>
<td></td>
<td>area over a selection rectangle</td>
</tr>
<tr class="even">
<td><strong>moving</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>event</td>
<td><code>caret_moved()</code></td>
<td></td>
<td>caret moved</td>
</tr>
<tr class="even">
<td><strong>editing</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>r/o property</td>
<td><code>text_len</code></td>
<td></td>
<td>text length in codepoints</td>
</tr>
<tr class="even">
<td>r/w property</td>
<td><code>insert_mode</code></td>
<td><code>false</code></td>
<td>insert mode (Insert key toggles)</td>
</tr>
<tr class="odd">
<td>r/o property</td>
<td><code>edited</code></td>
<td><code>false</code></td>
<td>text was edited</td>
</tr>
<tr class="even">
<td>method</td>
<td><code>undo()</code></td>
<td></td>
<td>undo the last operation</td>
</tr>
<tr class="odd">
<td>method</td>
<td><code>redo()</code></td>
<td></td>
<td>redo the last operation</td>
</tr>
<tr class="even">
<td>event</td>
<td><code>text_changed()</code></td>
<td></td>
<td>text changed</td>
</tr>
<tr class="odd">
<td><strong>drawing</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>method</td>
<td><code>caret_rect() -&gt; x, y, w, h</code></td>
<td></td>
<td>caret rectangle</td>
</tr>
<tr class="odd">
<td>method</td>
<td><code>draw_password_char(cr, i, w, h)</code></td>
<td></td>
<td>draw a password hiding symbol</td>
</tr>
<tr class="even">
<td><strong>cue</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>r/w property</td>
<td><code>cue</code></td>
<td></td>
<td>cue text</td>
</tr>
<tr class="even">
<td>r/w property</td>
<td><code>show_cue_when_focused</code></td>
<td><code>false</code></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="drop-downs">Drop-downs</h2>
<p>Drop-down menus are created with <code>ui:dropdown(attrs1, ...)</code>.</p>
<table>
<tbody>
<tr class="odd">
<td style="text-align: left;">TODO</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="sliders">Sliders</h2>
<p>Sliders are created with <code>ui:slider(attrs1, ...)</code>.</p>
<table>
<tbody>
<tr class="odd">
<td>r/w property</td>
<td style="text-align: left;"><code>min_position</code></td>
<td style="text-align: left;"><code>0</code></td>
<td style="text-align: left;">min. position</td>
</tr>
<tr class="even">
<td>r/w property</td>
<td style="text-align: left;"><code>max_position</code></td>
<td style="text-align: left;"><code>false</code></td>
<td style="text-align: left;">max. position (overrides <code>size</code>)</td>
</tr>
<tr class="odd">
<td>r/w property</td>
<td style="text-align: left;"><code>position</code></td>
<td style="text-align: left;"><code>0</code></td>
<td style="text-align: left;">current position</td>
</tr>
<tr class="even">
<td>r/w property</td>
<td style="text-align: left;"><code>progress</code></td>
<td style="text-align: left;"><code>false</code></td>
<td style="text-align: left;">current progress (overrides <code>position</code>)</td>
</tr>
<tr class="odd">
<td>r/w property</td>
<td style="text-align: left;"><code>step_start</code></td>
<td style="text-align: left;"><code>0</code></td>
<td style="text-align: left;">position of first step</td>
</tr>
<tr class="even">
<td>r/w property</td>
<td style="text-align: left;"><code>step</code></td>
<td style="text-align: left;"><code>false</code></td>
<td style="text-align: left;">no stepping</td>
</tr>
<tr class="odd">
<td>r/w property</td>
<td style="text-align: left;"><code>step_labels</code></td>
<td style="text-align: left;"><code>false</code></td>
<td style="text-align: left;">step labels: <code>{label = value, ...}</code></td>
</tr>
<tr class="even">
<td>r/w property</td>
<td style="text-align: left;"><code>snap_to_labels</code></td>
<td style="text-align: left;"><code>true</code></td>
<td style="text-align: left;">…if there are any</td>
</tr>
<tr class="odd">
<td>r/w property</td>
<td style="text-align: left;"><code>step_line_h</code></td>
<td style="text-align: left;"><code>5</code></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td>r/w property</td>
<td style="text-align: left;"><code>step_line_color</code></td>
<td style="text-align: left;"><code>'#fff'</code></td>
<td style="text-align: left;"><code>false</code> to disable</td>
</tr>
<tr class="odd">
<td>r/w property</td>
<td style="text-align: left;"><code>key_nav_speed</code></td>
<td style="text-align: left;"><code>0.1</code></td>
<td style="text-align: left;">constant 10% speed on left/right keys</td>
</tr>
<tr class="even">
<td>r/w property</td>
<td style="text-align: left;"><code>smooth_dragging</code></td>
<td style="text-align: left;"><code>true</code></td>
<td style="text-align: left;">pin stays under the mouse while dragging</td>
</tr>
<tr class="odd">
<td>r/w property</td>
<td style="text-align: left;"><code>phantom_dragging</code></td>
<td style="text-align: left;"><code>true</code></td>
<td style="text-align: left;">drag a secondary translucent pin</td>
</tr>
<tr class="even">
<td>event</td>
<td style="text-align: left;"><code>position_changed(p)</code></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">slider position changed</td>
</tr>
<tr class="odd">
<td>component</td>
<td style="text-align: left;"><code>track</code></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td>component</td>
<td style="text-align: left;"><code>fill</code></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td>component</td>
<td style="text-align: left;"><code>pin</code></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td>component</td>
<td style="text-align: left;"><code>marker</code></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td>component</td>
<td style="text-align: left;"><code>tip</code></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td>component</td>
<td style="text-align: left;"><code>step_label</code></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<h2 id="toggle-buttons">Toggle buttons</h2>
<p>Toggle buttons are created with <code>ui:toggle(attrs1, ...)</code>.</p>
<p>Toggle buttons are custom sliders so all slider options apply.</p>
<table>
<tbody>
<tr class="odd">
<td>r/w property</td>
<td style="text-align: left;"><code>option</code></td>
<td style="text-align: left;"><code>false</code></td>
<td>button is “on” or “off”</td>
</tr>
<tr class="even">
<td>tag</td>
<td style="text-align: left;"><code>:on</code></td>
<td style="text-align: left;"></td>
<td>button is “on”</td>
</tr>
<tr class="odd">
<td>event</td>
<td style="text-align: left;"><code>option_changed(v)</code></td>
<td style="text-align: left;"></td>
<td>button was toggled</td>
</tr>
<tr class="even">
<td>event</td>
<td style="text-align: left;"><code>option_enabled()</code></td>
<td style="text-align: left;"></td>
<td>button was set to “on”</td>
</tr>
<tr class="odd">
<td>event</td>
<td style="text-align: left;"><code>option_disabled()</code></td>
<td style="text-align: left;"></td>
<td>button was set to “off”</td>
</tr>
</tbody>
</table>
<h2 id="checkboxes">Checkboxes</h2>
<p>Checkboxes are created with <code>ui:checkbox(attrs1, ...)</code>.</p>
<p>Checkboxes are implemented as a flexbox with two items: a button and a textbox.</p>
<table>
<tbody>
<tr class="odd">
<td>r/w property</td>
<td style="text-align: left;"><code>align</code></td>
<td style="text-align: left;"><code>'left'</code></td>
<td>check button alignment vis label</td>
</tr>
<tr class="even">
<td>r/w property</td>
<td style="text-align: left;"><code>checked</code></td>
<td style="text-align: left;"><code>false</code></td>
<td>checkbox is checked</td>
</tr>
<tr class="odd">
<td>tag</td>
<td style="text-align: left;"><code>:checked</code></td>
<td style="text-align: left;"></td>
<td>checkbox is checked</td>
</tr>
<tr class="even">
<td>event</td>
<td style="text-align: left;"><code>was_checked()</code></td>
<td style="text-align: left;"></td>
<td>checkbox was checked</td>
</tr>
<tr class="odd">
<td>event</td>
<td style="text-align: left;"><code>was_unchecked()</code></td>
<td style="text-align: left;"></td>
<td>checkbox was unchecked</td>
</tr>
<tr class="even">
<td>event</td>
<td style="text-align: left;"><code>checked_changed(v)</code></td>
<td style="text-align: left;"></td>
<td>checked state changed</td>
</tr>
<tr class="odd">
<td>component</td>
<td style="text-align: left;"><code>button</code></td>
<td style="text-align: left;"></td>
<td>check button</td>
</tr>
<tr class="even">
<td>component</td>
<td style="text-align: left;"><code>label</code></td>
<td style="text-align: left;"></td>
<td>checkbox label</td>
</tr>
</tbody>
</table>
<h2 id="radio-buttons">Radio buttons</h2>
<p>Radio buttons are created with <code>ui:radiobutton(attrs1, ...)</code>.</p>
<p>Radio buttons custom checkboxes so all checkbox options apply.</p>
<table>
<tbody>
<tr class="odd">
<td>r/w property</td>
<td style="text-align: left;"><code>radio_group</code></td>
<td style="text-align: left;"><code>'default'</code></td>
<td>radio button’s option group</td>
</tr>
<tr class="even">
<td>r/w property</td>
<td style="text-align: left;"><code>align</code></td>
<td style="text-align: left;"><code>'left'</code></td>
<td>checkbox alignment vis its label</td>
</tr>
</tbody>
</table>
<h2 id="radio-button-lists">Radio button lists</h2>
<p>Radio button lists are created with <code>ui:radiobuttonlist(attrs1, ...)</code>.</p>
<table>
<tbody>
<tr class="odd">
<td style="text-align: left;">TODO</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="choice-buttons">Choice buttons</h2>
<p>Choice buttons are created with <code>ui:choicebutton(attrs1, ...)</code>.</p>
<p>Choice buttons are functionally like radio button lists. Visually they are implemented as a flexbox with multiple buttons, one of which is selected.</p>
<table>
<tbody>
<tr class="odd">
<td style="text-align: left;">TODO</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>event</code></td>
<td><code>value_selected()</code></td>
<td></td>
<td>a button was selected</td>
</tr>
</tbody>
</table>
<h2 id="color-pickers">Color pickers</h2>
<p>Color pickers are created with <code>ui:colorpicker(attrs1, ...)</code>.</p>
<table>
<tbody>
<tr class="odd">
<td style="text-align: left;">TODO</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="calendars">Calendars</h2>
<p>Calendars are created with <code>ui:calendar(attrs1, ...)</code>.</p>
<table>
<tbody>
<tr class="odd">
<td style="text-align: left;">TODO</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="progress-bars">Progress bars</h2>
<p>Progress bars are created with <code>ui:progressbar(attrs1, ...)</code>.</p>
<table>
<tbody>
<tr class="odd">
<td>r/w property</td>
<td style="text-align: left;"><code>progress</code></td>
<td style="text-align: left;"><code>0</code></td>
<td>progress in <code>0..1</code></td>
</tr>
<tr class="even">
<td>stub</td>
<td style="text-align: left;"><code>format_text(p) -&gt; s</code></td>
<td style="text-align: left;"></td>
<td>format progress text</td>
</tr>
</tbody>
</table>
<h2 id="editable-grids">Editable grids</h2>
<p>Grids are created with <code>ui:grid(attrs1, ...)</code>.</p>
<table>
<tbody>
<tr class="odd">
<td style="text-align: left;">TODO</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="scroll-bars">Scroll bars</h2>
<p>Scroll bars are created with <code>ui:scrollbar(attrs1, ...)</code>.</p>
<table>
<tbody>
<tr class="odd">
<td>r/w property</td>
<td style="text-align: left;"><code>content_length</code></td>
<td style="text-align: left;"><code>0</code></td>
<td></td>
</tr>
<tr class="even">
<td>r/w property</td>
<td style="text-align: left;"><code>view_length</code></td>
<td style="text-align: left;"><code>0</code></td>
<td></td>
</tr>
<tr class="odd">
<td>r/w property</td>
<td style="text-align: left;"><code>offset</code></td>
<td style="text-align: left;"><code>0</code></td>
<td>in <code>0..content_length</code> range</td>
</tr>
<tr class="even">
<td>r/w property</td>
<td style="text-align: left;"><code>vertical</code></td>
<td style="text-align: left;"><code>true</code></td>
<td>rotated 90deg</td>
</tr>
<tr class="odd">
<td>r/w property</td>
<td style="text-align: left;"><code>step</code></td>
<td style="text-align: left;"><code>false</code></td>
<td>snap</td>
</tr>
<tr class="even">
<td>r/w property</td>
<td style="text-align: left;"><code>autohide</code></td>
<td style="text-align: left;"><code>false</code></td>
<td>hide when mouse is not near the scrollbar</td>
</tr>
<tr class="odd">
<td>r/w property</td>
<td style="text-align: left;"><code>autohide_empty</code></td>
<td style="text-align: left;"><code>true</code></td>
<td>hide when content is smaller than the view</td>
</tr>
<tr class="even">
<td>r/w property</td>
<td style="text-align: left;"><code>autohide_distance</code></td>
<td style="text-align: left;"><code>20</code></td>
<td>distance around the scrollbar for <code>autohide</code></td>
</tr>
<tr class="odd">
<td>r/w property</td>
<td style="text-align: left;"><code>click_scroll_length</code></td>
<td style="text-align: left;"><code>300</code></td>
<td>how much to scroll when clicking on the track</td>
</tr>
<tr class="even">
<td>r/w property</td>
<td style="text-align: left;"><code>margin</code></td>
<td style="text-align: left;"><code>nil</code></td>
<td>margin when inside a scrollbox</td>
</tr>
<tr class="odd">
<td>tag</td>
<td style="text-align: left;"><code>:near</code></td>
<td style="text-align: left;"></td>
<td>autohidden scrollbar is visible</td>
</tr>
<tr class="even">
<td>tag</td>
<td style="text-align: left;"><code>vertical</code></td>
<td style="text-align: left;"></td>
<td>scrollbar is vertical</td>
</tr>
<tr class="odd">
<td>tag</td>
<td style="text-align: left;"><code>horizontal</code></td>
<td style="text-align: left;"></td>
<td>scrollbar is horizontal</td>
</tr>
<tr class="even">
<td>method</td>
<td style="text-align: left;"><code>empty()</code></td>
<td style="text-align: left;"></td>
<td>the content is smaller than the view</td>
</tr>
<tr class="odd">
<td>method</td>
<td style="text-align: left;"><code>scroll_to(offset, [duration])</code></td>
<td style="text-align: left;"></td>
<td>scroll to offset</td>
</tr>
<tr class="even">
<td>method</td>
<td style="text-align: left;"><code>scroll_to_view(x, w, [duration])</code></td>
<td style="text-align: left;"></td>
<td>scroll to position in view</td>
</tr>
<tr class="odd">
<td>method</td>
<td style="text-align: left;"><code>scroll(delta, [duration])</code></td>
<td style="text-align: left;"></td>
<td>scroll a number of pixels</td>
</tr>
<tr class="even">
<td>method</td>
<td style="text-align: left;"><code>scroll_pages(pages, [duration])</code></td>
<td style="text-align: left;"></td>
<td>scroll a number of pages</td>
</tr>
</tbody>
</table>
<h2 id="scroll-boxes">Scroll boxes</h2>
<p>Scroll boxes are created with <code>ui:scrollbox(attrs1, ...)</code>.</p>
<table>
<tbody>
<tr class="odd">
<td>r/w property</td>
<td style="text-align: left;"><code>wheel_scroll_length</code></td>
<td style="text-align: left;"><code>50</code></td>
<td>how much is a mouse wheel notch</td>
</tr>
<tr class="even">
<td>r/w property</td>
<td style="text-align: left;"><code>auto_h</code></td>
<td style="text-align: left;"><code>false</code></td>
<td>auto-height: TODO</td>
</tr>
<tr class="odd">
<td>r/w property</td>
<td style="text-align: left;"><code>auto_w</code></td>
<td style="text-align: left;"><code>false</code></td>
<td>auto-width: TODO</td>
</tr>
<tr class="even">
<td>r/w property</td>
<td style="text-align: left;"><code>scroll_margin</code></td>
<td style="text-align: left;"><code>0</code></td>
<td><code>scroll_to_view()</code> margin</td>
</tr>
<tr class="odd">
<td>r/w property</td>
<td style="text-align: left;"><code>scroll_margin_&lt;side&gt;</code></td>
<td style="text-align: left;"><code>false</code></td>
<td><code>scroll_margin</code> side overrides</td>
</tr>
<tr class="even">
<td>component</td>
<td style="text-align: left;"><code>vscrollbar</code></td>
<td style="text-align: left;"></td>
<td>the vertical scrollbar</td>
</tr>
<tr class="odd">
<td>component</td>
<td style="text-align: left;"><code>hscrollbar</code></td>
<td style="text-align: left;"></td>
<td>the horizontal scrollbar</td>
</tr>
<tr class="even">
<td>component</td>
<td style="text-align: left;"><code>view</code></td>
<td style="text-align: left;"></td>
<td>content’s parent layer</td>
</tr>
<tr class="odd">
<td>method</td>
<td style="text-align: left;"><code>scroll_to_view(x, y, w, h)</code></td>
<td style="text-align: left;"></td>
<td>scroll to view rect in content’s content space.</td>
</tr>
<tr class="even">
<td>method</td>
<td style="text-align: left;"><code>view_rect() -&gt; x,y,w,h</code></td>
<td style="text-align: left;"></td>
<td>view rect in content’s content space.</td>
</tr>
</tbody>
</table>
<h2 id="tab-lists">Tab lists</h2>
<h3 id="tabs">Tabs</h3>
<p>Tabs are created with <code>ui:tab(attrs1, ...)</code>.</p>
<table>
<tbody>
<tr class="odd">
<td>r/w property</td>
<td style="text-align: left;"><code>tablist</code></td>
<td></td>
<td style="text-align: center;">tab list owner</td>
</tr>
<tr class="even">
<td>r/w property</td>
<td style="text-align: left;"><code>index</code></td>
<td></td>
<td style="text-align: center;">order in tab list</td>
</tr>
<tr class="odd">
<td>r/w property</td>
<td style="text-align: left;"><code>selected</code></td>
<td></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td>method</td>
<td style="text-align: left;"><code>select()</code></td>
<td></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td>method</td>
<td style="text-align: left;"><code>unselect()</code></td>
<td></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td>tag</td>
<td style="text-align: left;"><code>:selected</code></td>
<td></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td>event</td>
<td style="text-align: left;"><code>tab_selected()</code></td>
<td></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td>event</td>
<td style="text-align: left;"><code>tab_unselected()</code></td>
<td></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td>method</td>
<td style="text-align: left;"><code>close()</code></td>
<td></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td>event</td>
<td style="text-align: left;"><code>closing() -&gt; [false]</code></td>
<td></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td>event</td>
<td style="text-align: left;"><code>closed()</code></td>
<td></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td>r/w property</td>
<td style="text-align: left;"><code>draggable_outside</code></td>
<td><code>true</code></td>
<td style="text-align: center;">can be dragged out of the tablist</td>
</tr>
</tbody>
</table>
<h3 id="tab-lists-1">Tab lists</h3>
<p>Tab lists are created with <code>ui:tablist(attrs1, ...)</code>.</p>
<table>
<tbody>
<tr class="odd">
<td>i/r property</td>
<td style="text-align: left;"><code>tabs</code></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>i property</td>
<td style="text-align: left;"><code>selected_tab_index</code></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>r/w property</td>
<td style="text-align: left;"><code>selected_tab</code></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>r/w property</td>
<td style="text-align: left;"><code>main_tablist</code></td>
<td></td>
<td>responds to Tab &amp; Ctrl+Tab globally</td>
</tr>
<tr class="odd">
<td>r/w property</td>
<td style="text-align: left;"><code>tablist_group</code></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>r/w property</td>
<td style="text-align: left;"><code>tab_spacing</code></td>
<td><code>-10</code></td>
<td></td>
</tr>
<tr class="odd">
<td>r/w property</td>
<td style="text-align: left;"><code>tab_slant_left</code></td>
<td><code>70</code></td>
<td>tab slant in degrees</td>
</tr>
<tr class="even">
<td>r/w property</td>
<td style="text-align: left;"><code>tab_slant_right</code></td>
<td><code>70</code></td>
<td>tab slant in degrees</td>
</tr>
<tr class="odd">
<td>r/w property</td>
<td style="text-align: left;"><code>tabs_padding_left</code></td>
<td><code>10</code></td>
<td></td>
</tr>
<tr class="even">
<td>r/w property</td>
<td style="text-align: left;"><code>tabs_padding_right</code></td>
<td><code>10</code></td>
<td></td>
</tr>
<tr class="odd">
<td>event</td>
<td style="text-align: left;"><code>tab_selected()</code></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>event</td>
<td style="text-align: left;"><code>tab_unselected()</code></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="creating-new-widgets">Creating new widgets</h2>
<p>The API for creating and extending widgets is necessarily larger and more complex than the API for instantiating and using existing widgets, since widgets are supposed to encapsulate complex user interaction patterns as well as provide customizable presentation and behavior.</p>
<p>The main topics that need to be understood in order to create new widgets or extend existing ones are:</p>
<ul>
<li>the <a href="/oo">object system</a> and its extensibility mechanisms:
<ul>
<li>subclassing and instantiation</li>
<li>virtual properties</li>
<li>method overriding</li>
</ul></li>
<li>the <a href="/events">event system</a>.</li>
<li>the <code>ui.object</code> class and its meta-programming utilities (decorators).</li>
<li>the <code>ui.element</code> class and the way its constructor works.</li>
<li>the <code>ui.layer</code> class and its visual model:
<ul>
<li>layer hierarchies with relative affine transforms and clipping</li>
<li>borders, backgrounds, shadows, aligned text</li>
<li>hit testing</li>
<li>layouting, for making the widgets elastic</li>
<li>freeing order</li>
</ul></li>
<li>the <code>ui.window</code> and <code>ui.layer</code> classes, which together provide an input model:
<ul>
<li>routing mouse events to the hot widget; mouse capturing</li>
<li>routing keyboard events to the focused widget; tab-based navigation</li>
<li>the drag &amp; drop API</li>
</ul></li>
<li>drawing with <a href="/cairo">cairo</a>, if you need procedural 2D drawing.</li>
<li>rendering text with [tr], if layers are not enough.</li>
</ul>
<h3 id="the-ui.object-base-class">The <code>ui.object</code> base class</h3>
<ul>
<li>inherits <a href="/oo"><code>oo.Object</code></a>.</li>
<li>inherits the <a href="/events">events</a> mixin.</li>
<li>common ancestor of all classes.</li>
<li>tweaked so that class hierarchy depth does not affect performance.</li>
</ul>
<h4 id="method-property-decorators">Method &amp; property decorators</h4>
<p>These are meta-programming facilities exposed as class methods for creating or enhancing the behavior of properties and methods in specific ways.</p>
<h3 id="objectmemoizemethod_name"><code>object:memoize(method_name)</code></h3>
<p>Memoize a method (which must be single-return-value).</p>
<h3 id="objectforward_eventsobj-events"><code>object:forward_events(obj, events)</code></h3>
<p>Forward some events (<code>{event_name1, ...}</code>) from <code>obj</code> to <code>self</code>, i.e. install event handlers in <code>obj</code> which forward events to <code>self</code>.</p>
<h3 id="objectstored_propertyprop-priv"><code>object:stored_property(prop, [priv])</code></h3>
<p>Create a r/w property which reads/writes from a “private field” (<code>priv</code> which defaults to <code>_&lt;prop&gt;</code>).</p>
<h3 id="objectnochange_barrierprop"><code>object:nochange_barrier(prop)</code></h3>
<p>Change a property so that its setter is only called when the value changes.</p>
<h3 id="objecttrack_changesprop"><code>object:track_changes(prop)</code></h3>
<p>Change a property so that its setter is only called when the value changes and also <code>&lt;prop&gt;_changed</code> event is fired.</p>
<h3 id="objectinstance_onlyprop"><code>object:instance_only(prop)</code></h3>
<p>Inhibit a property’s getter and setter when using the property on the class. instead, set a private var on the class which serves as default value. NOTE: use this decorator only <em>after</em> defining the getter and setter.</p>
<h3 id="objectenum_propertyprop-values"><code>object:enum_property(prop, values)</code></h3>
<p>Validate a property when being set against a list of allowed values.</p>
<h3 id="error-reporting">Error reporting</h3>
<h3 id="objectwarnfmt-..."><code>object:warn(fmt, ...)</code></h3>
<p>Issue a warning on <code>stderr</code>. Use this to report API misuses that are not fatal (ideally there should be no fatal errors at all).</p>
<h3 id="objectcheckret-fmt-...---retnil"><code>object:check(ret, fmt, ...) -&gt; ret|nil</code></h3>
<p>Issue a warning if <code>ret</code> is falsey otherwise return <code>ret</code>.</p>
<h3 id="submodule-autoloading">Submodule autoloading</h3>
<h3 id="objectautoloadt"><code>object:autoload(t)</code></h3>
<p>See <a href="/glue">glue</a>.autoload.</p>
<h3 id="the-element-constructor">The element constructor</h3>
<ul>
<li>the order in which attribute values are copied over when creating a new element can be altered with the class method <code>:init_priority{field-&gt;priority}</code> to accommodate any dependencies between properties.</li>
<li>some properties can be excluded from being automatically set this way with the class method <code>:init_ignore{field-&gt;true}</code>, in which case they must be set manually in the constructor.</li>
<li><code>init_priority()</code> and <code>init_ignore()</code> can be called multiple times on the same class, adding new fields every time.</li>
<li>the constructor <code>:init(ui, t)</code> receives <code>ui</code> followed by the merged arg table which is also set up to inherit the class, thus providing transparent access to defaults.</li>
</ul>
<h3 id="synchronization">Synchronization</h3>
<p>Synchronization is about updating a layer’s state when its writable properties are changed. Some parts of the state are updated directly as a result of updating the property (eg. changing a layer’s <code>parent</code> property moves the layer in the layer hierarchy immediately), while others are updated on the next frame, in a specific order, in multiple passes through the layer hierarchy: on a first pass, styles are applied (if any tags were added or removed; this can result in new transitions being created), then transitions are updated (if there are any in progress) and finished transitions are discarded. This is done via <code>sync()</code> which also calls <code>sync()</code> recursively on the layer’s children (hence the top-down call order).</p>
<p>Layouts are updated on a second pass by calling <code>sync_layout()</code> on the window’s view layer.</p>
<h4 id="layout-synchronization">Layout synchronization</h4>
<p>Every layer has a layout, which is responsible for sizing itself, as well as sizing and positioning its children. Layouts come in two flavors: wrapping and non-wrapping.</p>
<p>Non-wrapping layouts (<code>false</code> and <code>'textbox'</code> types) are computed in a single top-down pass via <code>sync_layout()</code>.</p>
<p>Wrapping layouts (types <code>'flexbox'</code> and <code>'grid'</code>) are computed in 4 passes as follows, assuming <code>layout_axis_order = 'xy'</code>: a bottom-up pass to compute the minimum width, a top-down pass to lay out all layers on the x-axis and line-wrap the horizontally-flowing text, another bottom-up pass to compute the minimum height now that the text has been wrapped, and a final top-down pass to lay out all layers on the y-axis. These steps are encapsulated in <code>sync_layout_separate_axes()</code> which call in order: <code>sync_min_w()</code>, <code>sync_layout_x()</code>, <code>sync_min_h()</code>, <code>sync_layout_y()</code>.</p>
<p>Because layers with wrapping layouts can have children with non-wrapping layouts and viceversa, wrapping layouts must implement <code>sync_layout()</code> too and likewise, non-wrapping layouts must implement <code>sync_layout_x()</code> and <code>sync_layout_y()</code>.</p>
<h3 id="freeing-order">Freeing order</h3>
<p>When a layer is freed, it is first unfocused, then its children are removed recursively depth-first, from the topmost to the bottommost, then the layer is removed from its parent.</p>
<h2 id="extending-the-core-engine">Extending the core engine</h2>
<p>Many aspects of the core engine can also be extended with:</p>
<ul>
<li>adding new attribute types and type matches</li>
<li>adding new transition interpolators</li>
<li>adding new transition blend modes</li>
<li>adding new ways to look-up fonts</li>
<li>adding new image file decoders</li>
<li>adding new layout systems.</li>
</ul>
<h2 id="changing-the-underlying-libraries">Changing the underlying libraries</h2>
<ul>
<li>changing the 2D graphics library requires mostly just re-implementing the various <code>draw_*()</code> methods of the layer class, since most widgets don’t use the graphics library directly, but use layers instead. Any library that can draw on a BGRA bitmap can work.</li>
<li>changing the text rendering engine requires re-implementing <code>sync_text_*()</code> and <code>draw_text()</code>, except for the editbox widget which uses [tr]’s selection and cursor objects extensively to select and edit the text, so those would have to be provided too.</li>
<li>changing the native windows library is a bit harder because <a href="/nw">nw</a>’s API is already very high-level and covers a lot of functionality seldom found in other libraries of this type. Adding missing functionality to <a href="/nw">nw</a> instead would probably be easier.</li>
</ul>
<h2 id="porting-to-a-new-platform">Porting to a new platform</h2>
<p>OS integration is done exclusively through the <a href="/nw">nw</a>, <a href="/fs">fs</a> and <a href="/time">time</a> modules, everything else being portable Lua code or portable C code. Even text shaping, a task usually delegated to the OS, is done with 100% portable code. The <a href="/nw">nw</a> library itself has a frontend/backend split since it already supports multiple platforms, so porting <a href="/ui">ui</a> to a new platform may be only a matter of adding a new backend to <a href="/nw">nw</a> (not to imply that this is easy, but at least it’s contained).</p>
