<!DOCTYPE html>
<html>
<head>
<title>X-WIDGETS DEMO</title>
<meta charset="utf-8">
<style>

* { box-sizing: border-box; }

@font-face {
	font-family: "x-widget";
	src: url("/OpenSans-Regular.ttf");
}

@font-face {
	font-family: "x-widget";
	src: url("/OpenSans-SemiBold.ttf");
	font-weight: bold;
}

body {
	padding: 1em;
}

button {
	white-space: nowrap;
}

a > button {
	font-family: widget, sans-serif;
	font-size: 100%;
	text-decoration: none;
	color: black;
}

h2 {
	font-weight: normal;
	margin-bottom: -4px;
}

/* main layout */

#layout {
	border-top: 1px solid #ccc;
	border-bottom: 1px solid #ccc;
	border-collapse: collapse;
}

.lb { border-left: 1px solid #ccc; }
.lp { padding-left: 20px; }

#code_td {
	position: relative;
}

#help {
	tab-size: 3;
	-moz-tab-size: 3;
}

#main {
	height: 100%;
	overflow: auto;
}

#code {
	position: absolute;
	width: 100%;
	height: 100%;
	border: 1px solid #ccc;
	border-left: 0;
}

#code:focus {
	outline: none;
}

#demo_list {
	display: flex;
	height: 520px;
	overflow: auto;
}

.x-dark #layout, .x-dark #code, .x-dark .lb { border-color: #333; }

</style>

<script src="ace.js" integrity="sha256-+svOVB1WmhKhTy7N21gWvtyXn91qF0r52P2hIArRRug="></script>

<link rel="stylesheet" type="text/css" href="fontawesome.css">
<link rel="stylesheet" type="text/css" href="x-widgets.css">

<script src="glue.js"></script>
<script src="divs.js"></script>
<script src="ajax.js"></script>
<script src="url.js"></script>
<script src="x-widgets.js"></script>
<script src="x-rowset-widget.js"></script>
<script src="x-listbox.js"></script>
<script src="x-grid.js"></script>
<script src="x-calendar.js"></script>
<script src="x-country-dropdown.js"></script>
<script src="x-cssgrid.js"></script>

</head>

<body class=x-widget>

<h2>X-WIDGETS DEMO</h2>
<table id=layout width=100% height=600 cellspacing=0>
	<tr>
		<td height=1>
			<a href="https://github.com/luapower/x-widgets" target=_blank>
				<button>
					<span class="fa fa-code-branch"></span> Code
				</button>
			</a>
		</td>
		<td class="main_td lb lp">
			<table width=100%>
				<tr>
					<td width=100%><h3>#main</h3></td>
					<td><button id=lights_button>Lights</button></td>
				</tr>
			</table>
		</td>
		<td class="code_td lb">
			<table width=100%>
				<tr>
					<td width=100%><h3>#code</h3></td>
					<td><button id=run_button>Run Code</button></td>
					<td><button id=reload_button>Reload</button></td>
				</tr>
			</table>
		</td>
		<td class="lp lb"><h3>#help</h3></td>
	</tr>
	<tr>
		<td valign=top width=160 id=demo_list_ct>
		</td>
		<td class="main_td lb lp" valign=top width=34% height=100%>
			<div id=main></div>
		</td>
		<td valign=top class="lb" id=code_td>
			<aceeditor id=code></aceeditor>
		</td>
		<td class="lb lp" valign=top width=25%>
			<pre id=help></pre>
		</td>
	</tr>
</table>
<div id=debugDiv></div>

<!--------------------------------------------------------------------------->

<template id=button_demo>
<help>

btn = button({
	text     : string|element
	icon     : 'class1 ...'
	primary  : true // make it stand out
	action   : () => when_clicked
})

btn.click()

</help>

<script>

main.add(
	button({
		text: 'Click me!',
		primary: true,
		action: function() { print('clicked') },
	}),
	button({
		text: H('Click&nbsp;<i>me</i>&nbsp;too!'),
		icon: 'fa fa-biohazard',
		action: function() { print('clicked') },
	}),
	button({
		text: H('Multiline text<br>works too!'),
		icon: 'fa fa-folder-open',
		action: function() { print('clicked') },
	})
)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=checkbox_demo>
<help>

cb = checkbox({
	text            : string|element
	align           : 'left' // |right
	center          : false  // |true
	checked_value   : true   // |anything
	unchecked_value : false  // |anything
	checked         : false  // |true
	validate        : (v) => error_string|anything_else
})

cb.checked   (r/w) true|false
cb.value     (r/w) checked_value|unchecked_value

cb.toggle()

</help>

<script>

main.add(checkbox({
	text: 'Wassup homie',
	value: 'wrong',
	validate: function(v) {
		return typeof(v) == 'boolean' || 'Value not a boolean'
	}
}))

c2 = checkbox({
	text: H('Yo wasup<br>I am multiline and right-aligned.'),
	align: 'right',
	checked: true,
})

c2.on('value_changed', function(v) { print(v, this.checked) })

main.add(c2)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=radiogroup_demo>
<help>

rg = radiogroup({
	items    : [text|element, ...]
	value    : index_in_items_array
	validate : (v) => error_string|anything_else
})

rg.value    (r/w) index_in_items_array

</help>

<script>

main.add(
	radiogroup({
		items: [
			'Option 1',
			'Option 2',
			H('Option 3<br>Multiple lines'),
		],
		value: 1,
	}),
	radiogroup({
		align: 'right',
		items: [
			'Option 1',
			'Option 2',
			H('Option 3<br>Multiple lines long text'),
		],
		value: 1/0,
		validate: function(v) { return v >= 0 && v < 3 || 'Selected option out of range' },
	})
)


</script>
</template>

<!--------------------------------------------------------------------------->

<template id=tooltip_demo>
<help>

tooltip({
	side    : 'bottom' // |[inner-]top|left|right|center
	align   : 'center' // |start|end
	type    : nothing  // |info|error
	target  : widget
	px      : 0        // x-offset from widget side
	py      : 0        // y-offset from widget side
	timeout : 'auto'   // |seconds
	check   : (target) => true_if_should_be_visible
	visible : true     // |false
})

tooltip.update()

</help>

<script>

b1 = button({text: H('aaa ^ aaa<br>aaa aaa aaa v aaa aaa aaa')})
b2 = button({text: H('aaa ^ aaa<br>aaa aaa aaa v aaa aaa aaa')})
b3 = button({text: H('aaa ^ aaa<br>aaa aaa aaa v aaa aaa aaa')})
main.add(H.div({style: 'text-align: center'}, H.div({}, b1), H.div({}, b2), H.div({}, b3)))

b1.style['margin-bottom'] = '10em'
b2.style['margin-bottom'] = '10em'

let s = 'aaa v aaa<br>aaa aaa v aaa aaa'

function check(e) { return e.hovered }

tooltip({text: H(s), side: 'right' , align: 'center', target: b1, type: 'info', check: check})
tooltip({text: H(s), side: 'top'   , align: 'center', target: b1, type: 'info', check: check})
tooltip({text: H(s), side: 'bottom', align: 'center', target: b1, type: 'info', check: check})
tooltip({text: H(s), side: 'left'  , align: 'center', target: b1, type: 'info', check: check})

tooltip({text: H(s), side: 'right' , align: 'start', target: b2})
tooltip({text: H(s), side: 'top'   , align: 'start', target: b2})
tooltip({text: H(s), side: 'bottom', align: 'start', target: b2})
tooltip({text: H(s), side: 'left'  , align: 'start', target: b2})

tooltip({text: H(s), side: 'right' , align: 'end', target: b3, type: 'error'})
tooltip({text: H(s), side: 'top'   , align: 'end', target: b3, type: 'error'})
tooltip({text: H(s), side: 'bottom', align: 'end', target: b3, type: 'error'})
tooltip({text: H(s), side: 'left'  , align: 'end', target: b3, type: 'error'})

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=toaster_demo>
<help>

ts = toaster({
	side    : 'bottom'  // |[inner-]top|left|right|center
	align   : 'center'  // |start|end
	timeout : 'auto'    // |seconds
	spacing : 6         // |pixels
	target  : document.body // |element
})

ts.post(text, null|'info|error', [timeout])

ts.close_all()

</help>
<script>

t = toaster({
	//
})

main.add(t)

t.post('Hello there', null, 1)
t.post('I\'ve got something to tell you...', 'info', 2)
t.post('Pay attention!', 'error', 3)

</script>
</template>


<!--------------------------------------------------------------------------->

<template id=notify_demo>
<help>

notify(text, null|'info|error', [timeout])

</help>
<script>

notify('Did you see that?', 'info')
notify('Where?')
notify('There!', 'error', 2)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=dialog_demo>
<help>

di = dialog({
	title   : string|element
	content : string|element
	footer  : 'name ... < name ... > name ...'
	buttons : {
		<name>: {
			icon: 'class1 ...'
			primary: false // |true
		},
	},
})

di.modal()

</help>
<script>

win = dialog({
	title: 'I\'m playing the title',
	content: div({}, 'I\'m just here for the demo.'),
	footer: 'some-button < yes no > apply:ok cancel',
	buttons: {
		yes: { icon: 'fa fa-thumbs-up' },
		no: { icon: 'fa fa-thumbs-down' },
	},
})

main.add(button({
	text: 'Click for modal',
	action: function() {
		win.modal()
	}
}))

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=toolbox_demo>
<help>

tb = toolbox({
	title   : string|element
	content : string|element
})

tb.show()

</help>
<script>

tb = toolbox({
	title: 'Imma toolbox',
	xxx: 'yyy',
	content: div({}, 'I\'m just here for the demo.'),
	x: 400,
	y: 100,
	w: 150,
	h: 300,
})


b = button({
	text: 'Click to show toolbox',
	action: function() {
		tb.show()
		tb.focus()
	}
})

main.add(b)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=menu_demo>
<help>

m = menu({
	items: [item1, ...]
})

<item>: {
	text      : string|element_cons
	action    : (item) => false_for_not_closing_the_menu
	enabled   : true  // |false
	icon      : 'class1 ...'
	separator : false // |true
	items     : [item1, ...] // submenu
	key       : '<modifier>+<key>'
}

m.popup(target, [side='bottom'], [align='left'], [px=0], [py=0])

</help>
<script>

function act(item) { print(item.text) }

m = menu({
	items: [
		{text: 'Open', action: act, key: 'Ctrl+B', icon: 'fa fa-folder-open'},
		{text: 'Close', enabled: false, icon: 'fa fa-window-close', action: act, separator: true},
		{text: 'More', items: [
			{text: 'Check', checked: true},
			{text: 'Check No Close', checked: true,
				action: function(a) { print(a.checked); return false } },
			{text: 'More Stuff', items: [
				{text: 'More Stuff 1 this is a very long item text'},
				{text: 'More Stuff 2', action: act},
			]},
		]},
		{text: 'Even More', items: [
			{text: 'Even More Stuff 1'},
			{text: 'Even More Stuff 2'},
		]},
	],
})

b = button({
	text: 'Click for menu',
	primary: true,
	action: function() { m.popup(b, 'bottom', 'left', 0, 2) },
})

main.add(b)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=input_demo>
<help>

ti = input({
	align        : 'left'    // |right
	mode         : 'default' // |inline|wrap|fixed
	nolabel      : false     // |true
	from_text    : (s) => v
	to_text      : (v) => s
	input_filter : (s) => true|false
	maxlen       : N
})

ti.value   (r/w)  input_value

</help>
<script>

function say_my_name(v) {
	return v == null || v == 'Klaus' || 'You have to type in "Klaus" or leave empty.'
}

main.add(H.div({}, 'type in "Klaus" to validate: ', input({
	value: 'wrong',
	validate: say_my_name,
})))

main.add(H.div({}, 'type in "Klaus" to validate: ', input({
	validate: function(v) {
		return v == null || v == 'Klaus'
			|| 'You have to type in "Klaus" or leave empty.\n' +
				'This error message is purposefully long to show that the default error box ' +
				'wraps decently and stays centered.'
	},
})))

main.add(
	H.div({style: 'padding-top: 2em'},
		'Check out these inner labels:',
		H.div({},
			input({
				field_name: "santa's_name",
				validate: say_my_name,
			}),
			input({
				field_name: "devil's name",
			})
		)
	)
)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=spin_input_demo>
<help>

si = spin_input({
	align            : 'right'      // |left
	mode             : 'default'    // |inline|wrap|fixed
	nolabel          : false        // |true
	button_style     : 'plus-minus' // |up-down|left-right
	button_placement : 'each-side'  // |left|right
	min              : N
	max              : N
	multiple_of      : N
	max_digits       : N
	max_decimals     : N
})

si.value   (r/w)  input_value

</help>
<script>

main.add(H.div({},
	spin_input({default_value: 42}),
	spin_input({default_value: 42, label: 'Heeey'})
))
main.add(H.div({},
	spin_input({button_style: 'up-down', value: 42}),
	spin_input({button_style: 'up-down', label: 'Hey hey'})
))
main.add(H.div({},
	spin_input({button_style: 'left-right', value: 42}),
	spin_input({button_style: 'left-right', label: 'Dis look good?'})
))
main.add(H.div({},
	spin_input({min: -2, max: 5, multiple_of: 1.5, button_placement: 'right', value: 1}),
	spin_input({min: -2, max: 5, multiple_of: 1.5, button_placement: 'right', label: 'How bout dis?'}),
))

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=slider_demo>
<help>

sl = slider({
	from        : 0
	to          : 1
	min         : N
	max         : N
	multiple_of : null // N
})

sl.value     (r/w)  value in min..max range
sl.progress  (r/w)  progress in 0..1 range

</help>
<script>

main.add(H.div({},
	'Slider 1',
	slider({
		validate: function(v) { return v >= .2 && v <= .8 || 'Value not between .2 and .8' },
		value: .5,
	})))

main.add(H.div({},
	'Slider 2',
	slider({value: 1500, from: 1000, to: 2000, multiple_of: 200, min: 1300, max: 1700}))
)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=listbox_demo>
<help>

lb = listbox({
	// standalone
	items   : [lb_item1, ...]
	value   : item_text
	// data-driven
	rowset  : rowset
	col     : field_name
})

<lb_item>: string | elem_cons | {
	text  : string | elem_cons
}

lb.value   (r/w)  get/set selected item by its item text.

</help>
<script>

lb = listbox({
	items: [
		'Apples',
		'Bananas',
		'Something Else Entirely',
	],
	value: 'Bananas',
})

hlb = hlistbox({
	items: [
		'Works',
		'Horizontally',
		'Too',
	],
})

sb = select_button({
	items: [
		'Choose',
		'One',
		'Of',
		'Us',
	],
})

main.add(lb, hlb, div({}, H('<h3>select_button</h3>'), sb))

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=pagelist_demo>
<help>

pl = pagelist({
	items: [pl_item1, ...]
})

<pl_item>: string | {
	text             : string
	page             : element_to_attach_to_container
	selected_index   : N
	can_add_items    : t|f
	can_remove_items : t|f
}

</help>
<script>

console_page = H.div({}, 'Console page. Contains focusble element. ', input())
source_page = H.div({}, 'Source page contents.')

main.add(
	pagelist({
		items: [
			'Elements',
			{text: 'Console', page: console_page},
			{text: 'Sources', page: source_page},
			'Network',
			'Performance',
		],
		selected_index: 3,
		can_add_items: true,
		can_remove_items: true,
		tabs: 'above',
		attrs: {style: 'height: 100%'},
	})
)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=split_demo>
<help>

sp = [v|h]split({
	1: first_element
	2: second_element
	resizeable: true // |false
})

</help>
<script>

sidebar = H.div({style: 'max-width: 300px; width: 200px'}, 'Sidebar')
header  = H.div({style: 'min-height: 100px; height: 200px'}, 'Header')
content = H.div({style: 'min-height: 100px;'}, 'Content')

main.add(
	hsplit({
		2: sidebar,
		1: vsplit({
			1: header, 2: content,
		}),
	})
)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=cssgrid_demo>
<help>


</help>
<script>

cg = cssgrid({
	items: [
		date_dropdown({pos_x: 3, pos_y: 1, value: day(time())}),
		input({pos_x: 2, pos_y: 2, value: 'hello1'}),
		input({pos_x: 1, pos_y: 3, value: 'hello2'}),
	],
})

cg.style.height = '100%'

cg.editing = true

main.add(cg)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=calendar_demo>
<help>

cal = calendar({
	value     : time
	validate  : (v) => error_string|anything_else
	rowset    : rowset
	col       : field_name
})

</help>
<script>

main.add(calendar())
main.add(calendar({
	value: day(time(), 1),
	validate: function(v) {
		if (day(v) == day(time()))
			return 'Can\'t have today.'
		if (day(v) == day(time(), 1))
			return 'Can\'t have tomorrow.'
	}
}))

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=grid_demo>
<help>

g = grid({
	can_edit              : true
	can_add_rows          : true
	can_remove_rows       : true
	can_change_rows       : true

	can_focus_cells       : true
	auto_focus_first_cell : true
	auto_advance_row      : true
	save_row_on           : 'exit_edit' // |input|exit_row|false
	insert_row_on         : 'exit_edit' // |input|exit_row|false
	remove_row_on         : 'input'     // |false
	can_exit_edit_on_errors : true
	can_exit_row_on_errors  : true

	rowset    : rowset
	col       : field_name
})

</help>
<script>

var checked = () => H('<div class="fa fa-check"></div>')

function starts_with_a(s) {
	return s.lower().starts('a') || 'Name must start with "A"'
}

var data = {
	fields: [
		{name: 'id'        , w:  50, min_w:  30, type: 'number', editable: false},
		{name: 'index'     , w:  50, type: 'number', editable: false},
		{name: 'active'    , w:  30, type: 'bool', true_text: checked, false_text: ''},
		{name: 'name'      , w: 150, min_w:  50, max_w: 400, validate: starts_with_a, filter_by: true},
		{name: 'parent_id' , w:  50, min_w:  50, type: 'number', allow_null: true, editable: false, focusable: false},
		{name: 'random_num', w: 130, allow_null: true, type: 'number', text: () => H('<i>Random</i><br>Number')},
		{name: 'date'      , w: 140, allow_null: true, type: 'date', filter_by: true},
	],
	pk: 'id',
	parent_col: 'parent_id',
	index_col: 'index',
	rows: new Set(),
	can_add_rows: true,
	can_remove_rows: true,
	can_change_rows: true,
}

for (let i = 1; i <= 10; i++) {
	let id         = i
	let name       = 'record '+i
	let parent_id  = floor((random() * i))
	let random_num = floor(random() * 1e9)
	let random_date = i * 24 * 3600 * 1000
	let row = [id, id, i % 5 == 0, name, parent_id, random_num, random_date]
	row.focusable = i % 10 >= 2
	data.rows.add(row)
}

d = rowset(data)

g = grid({
	rowset: d,
	w: 606,
	h: 500,
	can_change_header_visibility: true,
	//can_focus_cells: false,
	//order_by: 'parent_id name:desc',
	tree_col: 'name',
	can_move_rows: true,
	enter_edit_on_click_focused: false,
})

g.style.resize = 'both'

main.add(g)

log = tag('pre')
main.add(log)

d.on('row_changed', function() {
	log.html = json(d.pack_changes(), null, 3)
})

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=vgrid_demo>
<help>

g = vgrid({
	rowset        : rowset,
	col           : field_name
	can_move_rows : t|f
})

</help>
<script>

var checked = () => H('<div class="fa fa-check"></div>')

var data = {
	fields: [
		{name: 'id'        , w:  60, min_w:  30, type: 'number', editable: false},
		{name: 'index'     , w:  60, type: 'number', editable: false},
		{name: 'active'    , w:  30, type: 'bool', true_text: checked, false_text: ''},
		{name: 'name'      , w:  70, min_w:  50, max_w: 200, filter_by: true},
		{name: 'random_num', w: 130, allow_null: true, type: 'number', text: () => H('<i>Random</i> Number')},
		{name: 'date'      , w: 140, allow_null: true, type: 'date', filter_by: true},
	],
	pk: 'id',
	index_col: 'index',
	rows: new Set(),
	can_add_rows: true,
	can_remove_rows: true,
	can_change_rows: true,
}

for (let i = 1; i <= 1e5; i++) {
	let id         = i
	let name       = 'record '+i
	let random_num = floor(random() * 1e9)
	let random_date = i * 24 * 3600 * 1000
	let row = [id, id, i % 5 == 0, name, random_num, random_date]
	//row.focusable = i % 5 >= 2
	data.rows.add(row)
}

d = rowset(data)

vg = vgrid({
	rowset: d,
	w: 600,
	h: 200,
	can_change_header_visibility: true,
	//can_focus_cells: false,
	//auto_h: true,
	//auto_w: true,
	can_move_rows: true,
})

vg.style.resize = 'both'

main.add(vg)

log = tag('pre')
main.add(log)

d.on('row_changed', function() {
	log.html = json(d.pack_changes(), null, 3)
})

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=list_dropdown_demo>
<help>

ld = list_dropdown({

})


</help>
<script>

function thousand_items() {
	let a = []
	for (let i = 1; i <= 1000; i++)
		a.push('Record '+i)
	return a
}

main.add(
	list_dropdown({
		field_name: 'Here we are',
		items: [
			'Apples',
			'Mananas',
			'Bangos',
			'Something Else Entirely',
		],
		validate: function(v) { return v != 'Mananas' || 'Can\'t have mananas.' },
		value: 'Mananas',
	}),

	list_dropdown({
		field_name: 'Here we are again',
		items: thousand_items(),
		value: 'not-in-list',
	}),
)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=countries_listbox_demo>
<help>

clb = countries_listbox({
	value: 'CC', // country code
})

</help>
<script>

clb = countries_listbox({value: 'RO'})
main.add(clb)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=country_dropdown_demo>
<help>

cd = country_dropdown({
	value: 'CC', // country code
})

</help>
<script>

cd = country_dropdown({value: 'RO'})
main.add(cd)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=date_dropdown_demo>
<help>

dd = date_dropdown({

})

</help>
<script>

d = date_dropdown({
	value: time(),
	validate: function(v) {
		if (day(v) == day(time()))
			return 'Can\'t have today.'
		if (day(v) == day(time(), 1))
			return 'Can\'t have tomorrow.'
	}
})

main.add(d)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=grid_dropdown_demo>
<help>

gd = grid_dropdown({

})

</help>
<script>

r1 = rowset({
	fields: [
		{w:  50, name: 'id', type: 'number', visible: false},
		{w: 150, name: 'name'},
		{w: 150, name: 'date', type: 'date'},
	],
	rows: [
		[1, 'Hey Dude', day(time())],
		[2, 'Wasup'   , month(time())],
		[3, 'Nuthin'  , year(time())],
	],
})

main.add(
	grid_dropdown({
		value: 4,
		lookup_rowset: r1,
		lookup_col: 'id',
		display_col: 'name',
	})
)

rows2 = []
for (let i = 1; i <= 1e5; i++)
	rows2.push([i, 'Hey Dude #'+i])

r2 = rowset({
	fields: [
		{w:  50, name: 'id', type: 'number', visible: false},
		{w: 200, name: 'name'},
	],
	rows: rows2,
})

main.add(
	grid_dropdown({
		value: 42,
		lookup_rowset: r2,
		lookup_col: 'id',
		display_col: 'name',
	})
)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=dropdown_modes_demo>
<help>

</help>
<script>

function items() {
	return [
		'Apples',
		'Bananas',
		'Something Else Entirely',
	]
}

function p(mode, ...args) {
	return H.div({style: 'margin-top: 1em'}, H('<b>'+mode+'</b> mode:<br>'), ...args)
}

main.add(
	p('default', 'variable-width, no-wrap with min-width aligned with other inputs'),
	date_dropdown({value: time()}),
	H.div(),
	list_dropdown({items: items()}),

	p('inline', 'variable-width, no-wrap, with no min-width (shrink-wrapped), baseline-aligned'),
	date_dropdown({mode: 'inline', value: time()}),
	H.div(),
	list_dropdown({mode: 'inline', items: items()}),

	p('wrap', 'fixed-width, auto-wrap'),
	date_dropdown({mode: 'wrap', value: time()}),
	H.div(),
	list_dropdown({mode: 'wrap', items: items(), value: 'Something Else Entirely'}),

	p('fixed', 'fixed-width, no-wrap, overflow hidden'),
	date_dropdown({mode: 'fixed', value: time()}),
	H.div(),
	list_dropdown({mode: 'fixed', items: items(), value: 'Something Else Entirely'})
)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=inline_inputs_demo>
<help>

</help>
<script>

main.add(H.div({style: 'line-height: 3'},
	'All ',
	input({
		style: 'min-width: 4em',
		label: 'imma input',
		mode: 'inline',
		value: 'inputs',
	}),
	'are baseline-aligned',
	spin_input({
		label: 'imma spinner',
		style: 'min-width: 6em',
		mode: 'inline',
		value: 42,
	}),
	', including dropdowns ',
	date_dropdown({
		label: 'imma date',
		mode: 'inline',
	}),
	', which can be made to wrap-to-fit or grow-to-fit, and even',
	button({
		text: 'buttons.',
		primary: true,
		action: function() { print('clicked') },
	}),
	'This stays true under different fonts, font sizes and line heights.'
))

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=rowset_form_demo>
<help>

</help>
<script>

r = rowset({
	fields: [
		{w: 100, name: 'id', type: 'number'},
		{w: 100, name: 'name'},
	],
	rows: [
		[1, 'apples'],
		[2, 'bananas'],
	],
})

g = grid({w: 200, h: 200, rowset: r})

i1 = input({nav: g, col: 'name'})

main.add(H.div({}, g), i1)

main.add(button({
	text: 'unfocus row',
	action: function() { g.focus_cell(false) },
}))

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=lookup_col_demo>
<help>

</help>
<script>

fruits = rowset({
	fields: [
		{w:  50, name: 'id', type: 'number'},
		{w: 150, name: 'name'},
	],
	rows: [
		[1, 'apples'],
		[2, 'bananas'],
	],
	can_change_rows: true,
})

main.add(grid({w: 200, h: 200, rowset: fruits}))

r = rowset({
	fields: [
		{w: 100, name: 'fruit_id', type: 'number', align: 'left', text: 'fruit',
			lookup_rowset: fruits,
			lookup_col: 'id',
			display_col: 'name',
		},
	],
	rows: [
		[1],
		[2],
		[1],
	],
})

main.add(grid({w: 200, h: 200, rowset: r}))

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=ajax_demo>
<help>

</help>
<script>

pre = tag('pre')
main.add(pre)
function log(...args) { pre.add(args.join(' '), '\n') }

let req = ajax({
	url: '/ajax-test.txt',
	// timeout: 2,
	slow_timeout: .5,
	slow     : function(...args) { log('slow'       , ...args) },
	progress : function(...args) { log('progress'   , ...args) },
	done     : function(...args) { log('done'       , ...args) },
}).send()

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=ajax_json_demo>
<help>

</help>
<script>

pre = tag('pre')
main.add(pre)
function log(...args) { pre.add(args.join(' '), '\n') }

let req = ajax({
	url: '/ajax-test.json',
	upload: {a: 5, b: 7},
	slow     : function(...args) { log('slow'       , ...args) },
	progress : function(...args) { log('progress'   , ...args) },
	fail     : function(...args) { log('fail'       , ...args) },
	success  : function(j)       { log('success'    , json(j)) },
}).send()

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=data_grid_demo>
<help>

</help>
<script>

function starts_with_a(s) {
	return s.lower().starts('a') || 'Name must start with "A"'
}

var data = {
	fields: [
		{name: 'id'   , w:  60, min_w:  30, type: 'number', editable: false},
		{name: 'name' , w:  70, min_w:  50, max_w: 200, validate: starts_with_a},
		{name: 'date' , w: 140, allow_null: true, type: 'date'},
	],
	pk: 'id',
	url: 'rowset.json/test_static',
	slow_timeout: 1,
}

d = rowset(data)

g = grid({
	rowset: d,
	w: 500,
	h: 200,
})

main.add(g)

log = tag('pre')
main.add(log)

d.on('row_changed', function() {
	log.html = json(d.pack_changes(), null, 3)
})

d.load()

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=query_demo>
<help>

</help>
<script>

d = global_rowset('test_query')

g = grid({
	rowset: d,
	w: 500,
	h: 200,
	//remove_row_on: 'exit_row',
})

main.add(g)

d.load()

</script>
</template>

<!--------------------------------------------------------------------------->

<script>

ace_editor = ace.edit(code, {
	mode: 'ace/mode/javascript',
	highlightActiveLine: false,
	showGutter: false,
	printMargin: false,
	displayIndentGuides: false,
	tabSize: 3,
})

// disable Tab in the editor since we need to demo tab navigation.
ace_editor.commands.removeCommand(ace_editor.commands.byName.indent)
ace_editor.commands.removeCommand(ace_editor.commands.byName.outdent)

function run_script() {
	let s = ace_editor.getSession().getValue()
	main.innerHTML = ''
	let f = eval('let f = function() {\n' + s + '\n}; f')
	f()
}

let demos = []

$('template').forEach(function(e) {
	let id = e.attr('id')
	if (!id.ends('_demo'))
		return
	let name = id.replace('_demo', '')
	let t = window[name+'_demo'].content
	let h = t.$('help')[0]; h = h && h.innerHTML.trim() || ''
	let s = t.$('script')[0]; s = s && s.innerHTML.trim() || ''
	demos.push({text: name, help: h, code: s})
})

demo_list = listbox({items: demos, attrs: {id: 'demo_list'}})

demo_list.on('focused_row_changed', function() {
	let demo = this.focused_item
	ace_editor.getSession().setValue(demo.code)
	ace_editor.initial_script = demo.code
	run_script()
	help.innerHTML = demo.help
})

run_button.on('click', function() {
	run_script()
})

reload_button.on('click', function() {
	ace_editor.getSession().setValue(editor.initial_script)
	run_script()
})

demo_list.focus_cell(17)

demo_list_ct.add(demo_list)

lights_button.on('click', function() {
	let dark = !document.body.hasclass('x-dark')
	document.body.class('x-dark', dark)
	ace_editor.setTheme(dark ? 'ace/theme/tomorrow_night' : null)
})

</script>
</body>
</html>
